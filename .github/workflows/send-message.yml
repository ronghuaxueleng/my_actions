# File: .github/workflows/repo-sync.yml
name: 向telegram提交sharedcode
on:
  schedule:
    - cron: "0 9,21 * * *"
  workflow_dispatch:
  watch:
    types: started
  repository_dispatch:
    types: build
jobs:
  build:
    runs-on: ubuntu-latest
    steps:
      - name: checkout actions
        uses: actions/checkout@v1
      - name: 安装Python 3.8
        uses: actions/setup-python@v1
        with:
          python-version: 3.8
      - name: 提交shareCode
        run: |
          pip install Telethon==1.21.1
          phone=${{ secrets.phone }}
          password=${{ secrets.password }}
          api_id=${{ secrets.api_id }}
          api_hash=${{ secrets.api_hash }}
          sharedCodesJsonPath=${{ secrets.sharedCodesJsonPath }}
          phones=(${phone//@/ })
          passwords=(${password//@/ })
          api_ids=(${api_id//@/ })
          api_hashs=(${api_hash//@/ })
          sharedCodesJsonPaths=(${sharedCodesJsonPath//@/ })

          for ((i = 0; i < ${#phones[@]}; i++)); do
              python3 /jd/shareCode.py ${phones[i]} ${passwords[i]} ${api_ids[i]} ${api_hashs[i]} ${sharedCodesJsonPaths[i]}
              python3 /jd/shareCode1.py ${phones[i]} ${passwords[i]} ${api_ids[i]} ${api_hashs[i]} ${sharedCodesJsonPaths[i]}
              python3 /jd/shareCode2.py ${phones[i]} ${passwords[i]} ${api_ids[i]} ${api_hashs[i]} ${sharedCodesJsonPaths[i]}
          done
      - name: 删除过多的workflows
        uses: Mattraks/delete-workflow-runs@main
        with:
          token: ${{ secrets.AUTH_PAT }}
          repository: ${{ github.repository }}
          retain_days: 1
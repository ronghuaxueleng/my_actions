/*
活动名称：新版玩一玩兑换奖品 5.17-8.31结束
活动入口：APP-我的-更多工具-玩一玩
活动建议：定时自行修改，奖票有效期2个月
活动变量：jd_wyw_exchange // 填写兑换值，指定兑换奖品，不填默认兑换当前价值最高京豆奖品（需要指定请先随意添加变量查看打印兑换值）
          jd_wyw_notify  // 是否推送通知，默认不推送
          jd_wyw_pinFilter // 账号pin过滤，多个pin用@分隔，默认不过滤

cron:1 1 1 1 *

*/

const $ = new Env('新版玩一玩兑换奖品')
var iｉl='jsjiami.com.v7';function iii1II(_0x3dbc28,_0x3878ac){const _0x2e087b=Iii11l();return iii1II=function(_0xdd20f4,_0x576fda){_0xdd20f4=_0xdd20f4-0x14a;let _0x1881f4=_0x2e087b[_0xdd20f4];if(iii1II['YcZlZw']===undefined){var _0x517dd1=function(_0x1ecdb2){const _0x46a6d7='abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789+/=';let _0x3b8cf8='',_0x401ddd='';for(let _0x2023b8=0x0,_0x31b21a,_0x3b131b,_0x19afef=0x0;_0x3b131b=_0x1ecdb2['charAt'](_0x19afef++);~_0x3b131b&&(_0x31b21a=_0x2023b8%0x4?_0x31b21a*0x40+_0x3b131b:_0x3b131b,_0x2023b8++%0x4)?_0x3b8cf8+=String['fromCharCode'](0xff&_0x31b21a>>(-0x2*_0x2023b8&0x6)):0x0){_0x3b131b=_0x46a6d7['indexOf'](_0x3b131b);}for(let _0x3898e2=0x0,_0x51aa21=_0x3b8cf8['length'];_0x3898e2<_0x51aa21;_0x3898e2++){_0x401ddd+='%'+('00'+_0x3b8cf8['charCodeAt'](_0x3898e2)['toString'](0x10))['slice'](-0x2);}return decodeURIComponent(_0x401ddd);};const _0xdfa50e=function(_0x1ba87b,_0x16458c){let _0x4b7a4e=[],_0x1ca6ae=0x0,_0x4ee4a6,_0x2db8bf='';_0x1ba87b=_0x517dd1(_0x1ba87b);let _0x3fde01;for(_0x3fde01=0x0;_0x3fde01<0x100;_0x3fde01++){_0x4b7a4e[_0x3fde01]=_0x3fde01;}for(_0x3fde01=0x0;_0x3fde01<0x100;_0x3fde01++){_0x1ca6ae=(_0x1ca6ae+_0x4b7a4e[_0x3fde01]+_0x16458c['charCodeAt'](_0x3fde01%_0x16458c['length']))%0x100,_0x4ee4a6=_0x4b7a4e[_0x3fde01],_0x4b7a4e[_0x3fde01]=_0x4b7a4e[_0x1ca6ae],_0x4b7a4e[_0x1ca6ae]=_0x4ee4a6;}_0x3fde01=0x0,_0x1ca6ae=0x0;for(let _0xdade84=0x0;_0xdade84<_0x1ba87b['length'];_0xdade84++){_0x3fde01=(_0x3fde01+0x1)%0x100,_0x1ca6ae=(_0x1ca6ae+_0x4b7a4e[_0x3fde01])%0x100,_0x4ee4a6=_0x4b7a4e[_0x3fde01],_0x4b7a4e[_0x3fde01]=_0x4b7a4e[_0x1ca6ae],_0x4b7a4e[_0x1ca6ae]=_0x4ee4a6,_0x2db8bf+=String['fromCharCode'](_0x1ba87b['charCodeAt'](_0xdade84)^_0x4b7a4e[(_0x4b7a4e[_0x3fde01]+_0x4b7a4e[_0x1ca6ae])%0x100]);}return _0x2db8bf;};iii1II['Fynlat']=_0xdfa50e,_0x3dbc28=arguments,iii1II['YcZlZw']=!![];}const _0xa28c21=_0x2e087b[0x0],_0x5eddfd=_0xdd20f4+_0xa28c21,_0x15740f=_0x3dbc28[_0x5eddfd];return!_0x15740f?(iii1II['ActmUf']===undefined&&(iii1II['ActmUf']=!![]),_0x1881f4=iii1II['Fynlat'](_0x1881f4,_0x576fda),_0x3dbc28[_0x5eddfd]=_0x1881f4):_0x1881f4=_0x15740f,_0x1881f4;},iii1II(_0x3dbc28,_0x3878ac);}const lill1I=iii1II;(function(IlllII,I1il1I,II111,lI1l1I,lill11,liI1i1,I11i11){return IlllII=IlllII>>0x6,liI1i1='hs',I11i11='hs',function(I1llII,Iil1il,I11i1i,l1l1iI,I1llI1){const Iil1ii=iii1II;l1l1iI='tfi',liI1i1=l1l1iI+liI1i1,I1llI1='up',I11i11+=I1llI1,liI1i1=I11i1i(liI1i1),I11i11=I11i1i(I11i11),I11i1i=0x0;const I11i1l=I1llII();while(!![]&&--lI1l1I+Iil1il){try{l1l1iI=parseInt(Iil1ii(0x182,'Prgk'))/0x1+-parseInt(Iil1ii(0x1e4,'jG8!'))/0x2*(parseInt(Iil1ii(0x165,'Prgk'))/0x3)+-parseInt(Iil1ii(0x20e,'scX3'))/0x4*(parseInt(Iil1ii(0x187,'@xnr'))/0x5)+-parseInt(Iil1ii(0x17c,'BQsT'))/0x6*(parseInt(Iil1ii(0x1a3,'3(tM'))/0x7)+parseInt(Iil1ii(0x23a,'2fmN'))/0x8*(parseInt(Iil1ii(0x232,'jwVR'))/0x9)+-parseInt(Iil1ii(0x173,'WWx8'))/0xa+parseInt(Iil1ii(0x167,'q1q('))/0xb;}catch(il1il){l1l1iI=I11i1i;}finally{I1llI1=I11i1l[liI1i1]();if(IlllII<=lI1l1I)I11i1i?lill11?l1l1iI=I1llI1:lill11=I1llI1:I11i1i=I1llI1;else{if(I11i1i==lill11['replace'](/[GQDYEkTSXyCBIJOF=]/g,'')){if(l1l1iI===Iil1il){I11i1l['un'+liI1i1](I1llI1);break;}I11i1l[I11i11](I1llI1);}}}}}(II111,I1il1I,function(Il1i1i,iIIili,Ii1iiI,Ilil1I,iliIiI,II11iI,Il1i1l){return iIIili='\x73\x70\x6c\x69\x74',Il1i1i=arguments[0x0],Il1i1i=Il1i1i[iIIili](''),Ii1iiI=`\x72\x65\x76\x65\x72\x73\x65`,Il1i1i=Il1i1i[Ii1iiI]('\x76'),Ilil1I=`\x6a\x6f\x69\x6e`,(0x170434,Il1i1i[Ilil1I](''));});}(0x2f00,0x379e8,Iii11l,0xbe),Iii11l)&&(iｉl=0x44a);const jdCookie=require('./jdCookie'),notify=require('./utils/Rebels_sendJDNotify'),common=require(lill1I(0x1ab,'aH53'));let taskThreads=process[lill1I(0x15a,'BTQE')]['jd_wyw_threads']||'1';const runInterval=process['env'][lill1I(0x159,'EeoT')]||'1000',isNotify=(process[lill1I(0x23e,'DK5H')]['jd_wyw_notify']||process[lill1I(0x219,'lrWR')][lill1I(0x20d,'jwVR')])===lill1I(0x1fc,'v37p'),pinFilter=(process[lill1I(0x162,'@xnr')][lill1I(0x1c2,'lKSR')]||'')['split']('@'),exchange=process[lill1I(0x1cd,'206s')]['jd_wyw_exchange']||'';let hasGetBasicInfo=![],cookiesArr=Object[lill1I(0x1a1,'aH53')](jdCookie)[lill1I(0x205,'JLBr')](II1i1=>jdCookie[II1i1])['filter'](lI1lll=>lI1lll);!cookiesArr[0x0]&&($['msg']($[lill1I(0x269,'m%Pv')],lill1I(0x1c7,'6obq')),process['exit'](0x1));const rewardType_table={0x1:lill1I(0x26f,'aH53'),0x2:lill1I(0x17a,'p0Yp'),0x3:lill1I(0x17d,'aH53'),0x4:lill1I(0x157,'gq1D')},rewardType_map={'红包':0x1,'优惠券':0x2,'京豆':0x3,'现金':0x4};!(async()=>{const Ii1ii1=lill1I,iIiII={'ztVuD':Ii1ii1(0x164,'nf!u'),'AIsij':function(iil1lI){return iil1lI();},'zwPpP':function(iiiliI,li1i1I){return iiiliI!==li1i1I;},'IkWyO':'ISHeu'};notify['config']({'title':$['name']}),await iIiII['AIsij'](Main);if(isNotify&&notify['getMessage']()){if(iIiII[Ii1ii1(0x252,'jwVR')](iIiII['IkWyO'],'ISHeu')){const ii1il1=I1i111[Ii1ii1(0x26e,'fTuH')]||'',lI1llI=ilI1li[Ii1ii1(0x1cb,'5^d0')]||0x0,illIil=IIliI['rewardType']||0x0,Ill1I=ilI1ll['exchangeScore']||0x0,i11iiI=Iillii[Ii1ii1(0x1fa,'^brm')],lIli11=IlI1iI[Ii1ii1(0x216,'lrWR')];if(illIil!==0x2){const lllI1I=lIIiiI?Ii1ii1(0x209,'Hb4B')+lI1llI+'@'+illIil:'';II1lil+='\x20\x20'+ii1il1+'['+(i11iiI?'热门':'一般')+']-'+Ill1I+Ii1ii1(0x1f7,'gq1D')+(lIli11?'有库存':iIiII[Ii1ii1(0x207,'vNXR')])+lllI1I+'\x0a';}}else await notify['push']();}})()[lill1I(0x1f6,'n]bL')](lillI1=>$[lill1I(0x1a5,'lrWR')](lillI1))[lill1I(0x1e8,'$JlL')](()=>$[lill1I(0x1d8,'3(tM')]());async function Main(){const Ilil11=lill1I,IlIlii={'fSAEL':function(i1l1i1,liil11){return i1l1i1-liil11;},'poopU':function(iiillI,l1l111){return iiillI+l1l111;},'uSmtn':function(l1iIII,llI1I1){return l1iIII===llI1I1;},'HagOh':Ilil11(0x14d,'8IF1'),'bBmae':Ilil11(0x239,'czvV'),'mvIsQ':Ilil11(0x21f,'!vEv'),'PalIR':function(IlIlil,lIli1I){return IlIlil(lIli1I);},'EnQyK':'⚠\x20自定义运行间隔时长设置错误','umTTg':Ilil11(0x244,'n]bL'),'eOYlV':function(II1il,lllI11){return II1il>lllI11;},'DEMmD':Ilil11(0x178,'fTuH')};try{if(IlIlii[Ilil11(0x15f,'fObI')](IlIlii[Ilil11(0x14c,'Nu)]')],Ilil11(0x1e5,'206s'))){try{if(IlIlii[Ilil11(0x22c,')0)3')]===IlIlii[Ilil11(0x1ac,'q1q(')]){if(illIl1[Ilil11(0x258,'p0Yp')]&&l1llII[Ilil11(0x204,'8IF1')]['bizCode']===0x0){let {rewardType:II1ii,rewardName:IIIIII}=IiilI[Ilil11(0x1dc,'s@7H')][Ilil11(0x24e,'Oqb1')];ii1I11-=liIi1;let lillII=lI11II[II1ii]||'';l1llI1['log'](llIIll+'兑换成功:\x20'+lillII+IIIIII),IillIi[Ilil11(0x263,')0)3')](Ilil11(0x186,'v37p')+lillII+IIIIII);}else{let ii1ilI=lii['getErrorMsg'](IllI1i[Ilil11(0x19c,'nf!u')]);i11I1l[Ilil11(0x1ff,'2fmN')](lil+'兑换失败:\x20'+ii1ilI);}}else{const lI1ll1=IlIlii[Ilil11(0x154,'jwVR')](parseInt,taskThreads);lI1ll1>0x0&&lI1ll1!==0x1&&(taskThreads=lI1ll1);}}catch{taskThreads=0x1;}taskThreads=Math[Ilil11(0x214,'s@7H')](taskThreads,0x32),$['waitTime']=null;if(runInterval)try{const iIiI1=parseInt(runInterval);iIiI1>=0x0&&($['waitTime']=iIiI1);}catch{console[Ilil11(0x231,'vNXR')](IlIlii[Ilil11(0x202,'DK5H')]);}console['log']('=========='+$[Ilil11(0x269,'m%Pv')]+Ilil11(0x14e,'!vEv')),console[Ilil11(0x235,'czvV')](Ilil11(0x1af,'vNXR')),console['log']('兑换模式:\x20['+(exchange?IlIlii['poopU'](IlIlii[Ilil11(0x194,'n]bL')],exchange):'依据奖票数量兑换可兑换的最高京豆奖品')+']'),console['log'](Ilil11(0x152,'Hb4B')+(isNotify?'开启':'关闭')+']'),console[Ilil11(0x24b,']q]d')]('账号过滤:\x20['+pinFilter['join'](',\x20')+']'),console[Ilil11(0x199,'lKSR')](Ilil11(0x19a,'Hb4B')+$[Ilil11(0x21b,'Prgk')]+Ilil11(0x1fe,'2fmN')),console[Ilil11(0x1b9,'fTuH')](''),$[Ilil11(0x192,'FuWK')]=[],await common[Ilil11(0x1c9,'fTuH')](taskThreads,cookiesArr,taskFnc),$[Ilil11(0x1db,'Rtmm')]=![],$[Ilil11(0x169,'^Qln')]=![];if(IlIlii['eOYlV']($[Ilil11(0x1ca,'fObI')][Ilil11(0x171,'8IF1')],0x0)){if(IlIlii[Ilil11(0x221,'s%LQ')]!==IlIlii[Ilil11(0x1be,'DK5H')])return Iliill;else cookiesArr=cookiesArr[Ilil11(0x18f,'lrWR')]((i11ii1,IlIliI)=>!$[Ilil11(0x212,'n]bL')][Ilil11(0x1a4,'q1q(')](IlIliI+0x1)),$[Ilil11(0x25e,'Prgk')]=[];}const I1lIll=notify[Ilil11(0x206,'n]bL')]();I1lIll&&console['log'](Ilil11(0x180,'Hb4B')+I1lIll[Ilil11(0x1ea,'p0Yp')](/：/g,'\x20➜\x20'));}else{const iiill1=I1llii['slice'](0x0,0x2),lIli1i=lilIll['slice'](-0x2),IIIII1=l1i111['max'](IlIlii[Ilil11(0x16e,'BQsT')](iliII1-iiill1['length'],lIli1i['length']),0x0),I1lIlI='*'['repeat'](IIIII1);return IlIlii[Ilil11(0x175,'nf!u')](iiill1,I1lIlI)+lIli1i;}}catch(ii1ill){console[Ilil11(0x249,'Oqb1')](Ilil11(0x190,'s@7H')+ii1ill);}}function Iii11l(){const I1il11=(function(){return[...[iｉl,'ByYGjEIsEjJiTCaSmOikS.XckQoCFmC.kYvy7kDD==','W4hdSc3cNG','W7yrvMVdJCkkzGJdLtCVjWXfWR9U','WQmgWOtcQSkkea','W40ubvZcSG','WQTvE3GF','WP0PWPfhWOa','44kZ5O6O56ET44c/6k+w5yA76i+W5y26W4VcGwa1p8om','lmoSWPbkW4q','W7xcTLVcI8oNdmo/Ea','W7lcVSoXvb1LW6OmWRXzwLZdQmomc8k9W4ynyXK3','b3dcP0biWRONESomtCk9W7a','W5/cPmocW6S','W6xcVCkr','WQCgWPlcNCkabNG','zcuIWPu','W4lcK8oYW5mq','DCkhW7BdOJK','WRxORiRMSQJLPzxOTORdV+kDPau','WPO+WO5WWP0','W5RcOmoBW7O8wG','W4tdTdpcI3q2CvjrWQy','W7VcMmkpamo9WRRcLuRdHSk+W6PjW4ykgSkmEmoHoJ3cHa','5Bw66k6D57+W6lwg6l6j6l6k6kk/5BYc5yQx6lsT5y63','WRRcMZHu','WO0Avbj1W6y8BN0SWO7dOeS','W45PgmkU','z3yXuvq+WOqOkZddJMRdPCosuq','W6XcW6RdLa','5PYP6k+U5yAd5O2j6Ag85AAk6lsQtqq','WORdNmk8WOxcJ8ouugiasKm','EqrIW7uU','WQFdHCoBuSkzW6FdIvddGmklW5nrW7e','nKVdH8k+W78','WQPLWQO','eCk5dCotW47cSgTvWP7cIZu','dCoGW73dOrpdHSkaDSkp','W4JcSCkckcu','vmkgW4byWRpdOLq','WPNdOmkoWPlcIq','vJhcTuvMW6zp','c8kStaNdN8k/u0JdUCk2','WR5PWQjhAmoyAG','y8kpW44','w0tdT8o7WRW','t8kpW6RdNXu','W7ddN8oBwY3dNmoWwZi','W7aoahRcTa','WOzMWRGGda','cSkxW41xyuOJrun2W7dcQSo8rmo8W7NdUSowW6NcQSk3','nSo1gbqyvCkdWQni','5P2M6k2j5yE45O2q6Ac25AAk6lA8b2S','WRHEWRKQ','W4tcRhJcV8ox','WO7dKeaYDq','5Aww56AUbW','i8ocWQPUW6HdW7LBWO3dVwZdTmkD','w8k8WPqt','WPJcICkc','6lwq5yYR5PAz5PEE','ECksW4ZdKW','BGz5W6y','5y656yE/54MJ5OkP57Ul5P+XDmoFWOhdVmkwkmo9yCoGCq','dv/cSG','e8ktW4fhz0yJtW','W51gW7VdHbG','W6HOlCkYsG','5ywC5O6c5AAi6lAtECok','WOWdqXS','WOddMmk4','WORdLeaCEmkBWRHlWRZdJW','zmkpW7b9W7G','6lwY5y+I5PEY5PET','WQlLHPdMJ6tLG7VdOa','W6rmW7K','W4tcQSom','WPaIWPrmWQy','WRhdPSkVW53cMmoeWPhcRLq9W47cHxO','uSosWRCbW7BcNvXYW6PxdCkt','WRvss0yGnq','W6pcRSoH','fKFdMCk9W6VdHa','WOpdLfe1t8knWQzfWQ3dJZ3cTCoPWPXpWOVdPgmjAIW','yCk0WPNdSJu','W6vkW7a','BHyOCW','yGz+W5q/CN1L','W7/cT1BcHmogcCoPya','WQTEWQmYnSoEy1RcRmkwW53cH0ucBCkWW7z7t8kbWOaj','BWL7','W77cTKe','th/dKmoT','c8kSsW3dJmkV','W5auWR5nra','cMZcSW','W7xdOCoAycy','aepdNSkP','W4CNjhtcLq','xvybr38'],...(function(){return[...['WOiDWQXdWPO','EhySEe8GWOSYntBdGKddO8ovumogWO8','gCkbW6zdWQm','vtugzaK','b8k3kmoKW5u','5RAZ5yQl5AEi5zg0772uua','zaOaEtFdV3e','5B2J5yIv5P+s','W4mGW4Dviq','uSo5WQTfjG','WQxdQqZdMCkcvmk0xmoCp1uOWRi','W6NcPSorWRtcTq','WOxcOxldKJDGEwjzWRtdQCom','W4PJcmkhycFdPHXAWOKzm8oWWP5cFmk6tSoO','CSkuW4e','W6RcSSobWP7dKSowWQ/cJN8fW7q','jgbHW40','B8kpW5BdMIBcI3K','W4qQW4y','x8kYWRVdPa','AM8HAuC5WO05otddLvhdRG','4P+pqUADG+EFVoISPUAXKmkU','W6ewW7Dmfa','uWxdP8kyt8omoCkeW5pcJa','W6xcS8osqXO','nwzHW4WfWRJcGaS1W6xcGSoC','W7PgW6NdLdW+WQCOWQPU','W4HOcG','roISHEAZQUwKGUI0LG/IN5ik5PEv5zoE5BIN5PA15O+9','WR3cNSk/tSk1','WPe1WPbnWOdcMa','WP7cLCkvzCkC','5AA756Ezgq','5O+Q5AYR5ywL5OYZ5ycHW5ldQW','ESkbW5ddGHFcG3Pd','4P+qvEIeK+ACSoI9PoIISEMbVUwjIos4UUMvGoIUHKq','WQdcLWBcV8oh','5yAn5O2D5AE86lwUzCkj','WQKaWO8','WQ9tWQqOoG','r8kMWOa','WPJdRCkEW57cHmoDWRRdJw8WW5FcHG','W7NcO8o3wc5UW6agWPLFDKhdOG','WRCkWPVcQ8kdfG','wCkSWPaAWPXSos7cM3q','CSkJwWumFmkh','W5HSW43dOq','WQhdTCkGW5RcSq','W7FcT8k2paS','W6xcVSozFYm','uCoiWRvnjmkIWOZcS8o/ASkWW5q','ECkEW5jnW47dLaJcPmkFouy','m3bMW6aqWQtcGHWwW6lcRa','WQHTWQzk','W6BcUSkF','phrHW7ywWRNcJGu','bmk5dSo3W47cPLbEWQpcNq','5ys35O2H5OUe5yQ2fCo0','8jwPOSoh','thVdMmoSWPRdKxSHW6/cIWVdNCkFECkoW4ZcOrxdRdddLW','B8kjW4pdTsZcJNi','D8kNraKaEmksWPDrW6FcQSoOb19cW6hdSSouwMK7W4G','WOZdGuq9DmklWQPEWRldHrddTCo+W5PrWPNdMIalycBcO3/dM27cM0VdNmo5W6xcPJtdJW','WOm6WOpcUCkj','wCovWRvbmCk4','5Bsk6k+L576n6lEB6lY16lY86kcj5B6x5yM36lEb5y+2','nmoFWRPZW6vz','WQaBvqbN','WORdLeayC8keWQjeWR7dQrhcTmoYWPjiWPO','t3/dHq','kmoBWQrJ','jCoiWQXNW71i','W4qDWQnRu8kbkmoEW4xcNwG','DSkkW7K2','W73cICkEfmoCW6xdLWRdGmkPW4zcW4WxxCkeh8oLoNBcN3bk','W6tcVelcICobcCocCSoeaW','d+E6T+wmL8o4','WQikWPZcM8kDehiSzgWr','WQVdRmkJWQFcMW','FZ8nrce','W77dScpcPw4','WQaauIL3','5y2B6ywK5B6P5zcD54U15Ok6WQqaDHpdPSkInMvhW6O','W5NcKCkHamol','rZVcR0bM','W7ajW6TRgG','6ykv55YK5OYU6yogW6dcNsW','CSkEW4HVW4JdJG','WOVdO8kCW6pcSW','WPddQCkAW6dcKW','W7ZcK8kjcmoAWRVcNvy','w+EnTUMhUY0','W4ZcPmoFW74','WRzBWPi8jSoExv3cNCkhW4dcLLScBW','iCkYtW','W59ZeSkoBZC','WOhdLSkV','W7NdRCoMwsS','WQWbWOVcSSkAbNGT','W6NcImo5rce'],...(function(){return['W57dPtdcMNvOebXDWRpdKmkNWQr/WQFcMvNcKLjgnCogWQWtWQ0GjGpcNCkvheNdNSkQ','a8kxW5XWxeaLq1bfW5lcQCoMsG','yCodCG','W6FdTmozW7BdTmknwrm','5PAw5BMp5AYH','esFcJSoLWR3dOeiHW5m','cmkDW48','sSo5aLNcNmoIjwBdOCkkEtT2','WP0JWObaWPpcGIlcOwNcHg4FWOu','W77cS8oWWRmFvG','z1ySA2O','nCooWRTVW6DkW7DyWQC','5ys35O2H5yoO5y+X6yEG5Ak/5yEt6zsg6k2n77Y16kYd5Ao/5yEb5Q6l56ob55QE5ywA5O+t5ycyWOK','futcH8oKqa','W47cLSoQW5Or','W5azqNJdKa','eCkSwGZdImkPBG','WOqhwr1GW6a','WQBdHmozcCoAWOVcReRdUG','vColWP8gaHP+CfXeW5xcLSo2','W7NcTmogWQuK','bSkZfSoMW6K','l8olWPC8WO/dGWBcUmkwbNi','y3GL','W4pcNxtcRmo0','tmkYWQBdSq','WPFKVjtMGllLIjnu','4PQQr+IhP+wSNEs4GUI/JEIHKUMxUUMyNEAuQoMxOoIUI+E9SEMvRoIVHG','WP7cKmoLW6GoveK','d+s6UEIXLmo4','W5RORR3MSl7LKjpLUy5S','aMlcOeG','WOxXJ4gLW6FOViROO7hNUQtMNR9c','W6FdISoDuW','es7cHmk/W7hcHeqcW5VcPtNdQa','WOqnua','5P2L6kYX5yA25OYz6AcZ5Asm6lsbWQ8m','5RAy5yUq5AAb5zoV77Y7W7K','5ywC5O6c5OQP5yIPECok','mCojrCkXxa9H','W48DWRLjvCkB','FSkvW5RdLsBcMwq','WONdImk+W6hcTW','ce/cO1LQ','WR7cRCkJASkO','5PYe5BMZ5A+H','uCkIWQGVWR4','Ba5HW7mUBW','4P+ea+IgHoAEMEI+NUIGLUMcTowjOEs5NoMuKUIURXS','W5RcLCk4dCoR','WPy+WOzmWQdcIsJcQ0ZcGKicWO/dPCouW45zxvFdQqm','dSkqf8o+W5S','WPJdNgafEG','sCkMWQhdGaZdUa','kmk5v8k+W6SA','WPJcR8kAyCkT','W63dSSoRra8','W7aABG','WRldVmk7W7RdP8kasH51W4a','j8okWRLQW6boW79kWRFdSw3cQCksWQawxIxcI8ofW7ldS8ofWPRcLgzyWOFcMGdcTaFdSCoE','eSk9dCo3','lSovWR0','WPq0WOq','W60nhG','WRpcLs4','p3bRW5y','W7a6rgRdPq','W6ZdJgCha8oYW4bYWRq4A8krWQO','emkNwatdMmk/EfO','zGHQW4i5BW','W7JcOmoOWR7cS8okfK0xWPJcLSoBCmozs33dIW','W5axWQvA','wSojWPnqka','A8kCWQldJGa','cCooWOTXW5S','EJPNW5elWRRcNKejW7tcQCoDcNLVgSoFfCkSWR82t8oI','fmk/CHVdVa','5yAP5OY55yoF5y+W6ys95Akh5yEC6zED6k+v77+R6k+25Acg5yw55Q+T56ot55IV5ywb5O2r5ycpW7i','bLxcOCoKECoAlmkrW4JcGmoBzCkwoCkVp1VcLKa','5RsL5yMt5yEd5y+RWOBcHIBcHSkcz+AiSoEyHSkz5PUm5AAW5Bwu5yAUW6VNJjpKU7tNJiy','WPtcH8kczq','BmkoW4HnW5ldGG','WPiRd8knWQ4JW6r0','FmkwWPS','W4fJeSkSDtS','4P6xWQlMN5ROGzFMROlNO53LP4RNK6yB','WPq+WO1pWOBcHa','pmk3q8kDW54','WOxdKeCcACkhWQHb','W7RcTLi','W67cSSo1WQ7cVCotgKyMWONcP8oC','W6RcK8owWRtcGG','j03dHmk8W6ldNIddVvryzgC','W77cRuhcMmoav8kJpmoifKr8WO7dSSohkq/cH8kkWPffwCkJhmogWQ7dJaBdHmkFW61PlgO','W6LdmCkMrq','WR9LWRvfBmoFuabmqa','W73cPmo1WRlcTSoj'];}())];}())];}());Iii11l=function(){return I1il11;};return Iii11l();};async function taskFnc(II1iI,llI1II){const i1ii1=lill1I,lIli1l={'bemXo':i1ii1(0x1d7,'s@7H'),'zFOkh':function(I1l11i,iIIiiI){return I1l11i-iIIiiI;},'NKUnL':function(liiI1i,ililIi){return liiI1i+ililIi;},'hAnjL':function(lilIIl,ililIl){return lilIIl(ililIl);},'nsoNV':function(liiI1l,i1l1II){return liiI1l>i1l1II;},'CROVG':function(i1ill,I1l11l){return i1ill!==I1l11l;},'XLJrY':function(lilIIi,i1l1Il){return lilIIi!==i1l1Il;},'OhRiD':'SqjPf','yhFsU':'qkQri','nLwpE':function(llIli,i1i11l){return llIli==i1i11l;},'CQJkK':function(i1i11i,II11l1){return i1i11i===II11l1;},'GZSuN':i1ii1(0x262,'Oqb1'),'jrUtk':function(Iil1lI,IiiliI){return Iil1lI==IiiliI;},'eRPsX':'Zxmkq','KkjJr':function(iii1iI,llIll){return iii1iI===llIll;},'tYFRt':'rFARq','ZYukS':i1ii1(0x174,'^Qln'),'YJIJG':i1ii1(0x24c,'jwVR'),'MiaPu':i1ii1(0x160,'Nu)]'),'zkOTP':'android','meDJt':'wanyiwan_exchange','hIleI':i1ii1(0x26c,'m%Pv'),'yeMOl':'signed_wh5','ttRLX':i1ii1(0x18a,'jwVR'),'lRBKb':i1ii1(0x266,'8IF1'),'NvlEc':i1ii1(0x26d,'LNQ4'),'xcgzd':'https://pro.m.jd.com/mall/active/3fcyrvLZALNPWCEDRvaZJVrzek8v/index.html','RuMWd':function(il1iII,iilli){return il1iII!==iilli;},'OtBwR':i1ii1(0x198,'!vEv'),'eoQBZ':function(IlllIl,II11lI){return IlllIl(II11lI);},'jVYLM':function(lI1IIi,I1l11I){return lI1IIi(I1l11I);},'POmKb':function(Ilil1l,iIIiii){return Ilil1l===iIIiii;},'RACFY':i1ii1(0x1fb,'nf!u'),'ZgVwW':'wanyiwan_exchange_page','YZTed':i1ii1(0x1e1,'1N9u'),'KiOQf':i1ii1(0x22e,'Hb4B'),'xkzDA':i1ii1(0x16f,'lKSR'),'lOMvQ':function(iilll,il1iI1,IlllIi){return iilll(il1iI1,IlllIi);},'UeeqV':'BoSiV','kefLb':function(iIIiil,i1l1Ii){return iIIiil<i1l1Ii;},'OPWxh':function(I1iIIi,I1iIIl){return I1iIIi+I1iIIl;},'xgOTz':function(lI1IIl,i1ilI){return lI1IIl*i1ilI;}};if($['runEnd'])return{'runEnd':!![]};const lillIi=decodeURIComponent(common[i1ii1(0x161,'WWx8')](II1iI,i1ii1(0x20f,'$D*z')));function illIi1(iii1lI,i1ilI1){const il1ii=i1ii1;if(il1ii(0x1ec,'Prgk')===il1ii(0x242,'^brm')){if(lliii1[il1ii(0x158,'BQsT')]&&Iiii1['data']['bizCode']===0x0)l1iii=IIlli[il1ii(0x1dc,'s@7H')][il1ii(0x211,'1N9u')];else{let Iil1li=l1iil[il1ii(0x257,'aH53')](ii1l1[il1ii(0x181,'!vEv')]);lIIill[il1ii(0x20a,'s@7H')](I11iIi+il1ii(0x1dd,'p0Yp')+Iil1li);}}else{if(iii1lI[il1ii(0x153,'vNXR')]<=0x4)return iii1lI;else{const Iiilil=iii1lI[il1ii(0x1ef,'s%LQ')](0x0,0x2),Iil1ll=iii1lI[il1ii(0x21d,'6obq')](-0x2),iillI=Math[il1ii(0x1a0,'3(tM')](i1ilI1-Iiilil[il1ii(0x1b6,'FuWK')]-Iil1ll['length'],0x0),lI1III='*'[il1ii(0x21c,'q1q(')](iillI);return Iiilil+lI1III+Iil1ll;}}}const ii1ili=lIli1l['eoQBZ'](decodeURIComponent,lillIi),liil1i=illIi1(ii1ili,0x6),lI1lil='【账号'+llI1II+'】'+liil1i+'：',i1l1iI=notify[i1ii1(0x26a,'m%Pv')](llI1II,lillIi);if(lIli1l[i1ii1(0x1c5,'$D*z')](pinFilter[i1ii1(0x196,'BTQE')],0x0)&&(pinFilter[i1ii1(0x217,'fTuH')](lillIi)||pinFilter[i1ii1(0x156,'LNQ4')](lIli1l[i1ii1(0x1c8,'m%Pv')](encodeURIComponent,lillIi)))){i1l1iI['fix'](i1ii1(0x264,'FuWK')),console[i1ii1(0x166,'WWx8')](i1l1iI[i1ii1(0x267,'n]bL')]()),$[i1ii1(0x1f1,'WWx8')][i1ii1(0x233,'aH53')](llI1II);return;}const liil1l=await common['getLoginStatus'](II1iI);if(!liil1l&&lIli1l[i1ii1(0x1a9,'jG8!')](typeof liil1l,i1ii1(0x234,'v37p'))){console[i1ii1(0x21e,'5^d0')](lI1lil+i1ii1(0x208,'aH53')),i1l1iI[i1ii1(0x259,'206s')](lIli1l[i1ii1(0x222,'Rtmm')]),$['needRemoveCookieIndex']['push'](llI1II);return;}const lI1lii=common['genUA'](lillIi);let Iiili1=![],Iil1l1,i1i11I,il1iIl,iii1ii,il1iIi;await lIli1l[i1ii1(0x1d0,'BQsT')](II11li,lIli1l[i1ii1(0x213,'jG8!')]);if(Iil1l1){if(lIli1l['RuMWd']('YnSEi','YnSEi')){iIIl11[i1ii1(0x1e2,'p0Yp')](lIli1l[i1ii1(0x1d3,'FuWK')]),l1l1I1[i1ii1(0x1b9,'fTuH')](I1iIll['getInlineContent']()),I1lliI['needRemoveCookieIndex'][i1ii1(0x1f9,']q]d')](llIllI);return;}else{const IllIiI=Iil1l1['moreExchanges']||[];iii1ii=Iil1l1[i1ii1(0x1df,'lrWR')]||0x0,Iiili1=Iil1l1[i1ii1(0x229,'TeYd')]||![];if(!Iiili1)return;let i1il1='';if(!hasGetBasicInfo){if(lIli1l['YZTed']!==lIli1l['KiOQf']){hasGetBasicInfo=!![];for(let I1l111 of IllIiI){if(lIli1l[i1ii1(0x226,'TeYd')](i1ii1(0x14f,'LNQ4'),lIli1l[i1ii1(0x1b7,'BTQE')]))i1III[i1ii1(0x15c,'JLBr')](i1ii1(0x246,'lKSR')+Ii1iIi);else{const I1iIII=I1l111[i1ii1(0x1e9,'q1q(')]||'',liiI11=I1l111[i1ii1(0x255,')0)3')]||0x0,ililI1=I1l111[i1ii1(0x24f,']q]d')]||0x0,IIii1i=I1l111[i1ii1(0x1f8,'m%Pv')]||0x0,i1ili=I1l111[i1ii1(0x19d,'m%Pv')],Iiill1=I1l111[i1ii1(0x25a,'aH53')];if(ililI1!==0x2){const I1iII1=exchange?'-兑换值:'+liiI11+'@'+ililI1:'';i1il1+='\x20\x20'+I1iIII+'['+(i1ili?'热门':'一般')+']-'+IIii1i+'奖票-'+(Iiill1?'有库存':'无库存')+I1iII1+'\x0a';}}}console['log'](i1ii1(0x228,'s@7H')+i1il1);}else{if(li1Ii['length']<=0x4)return IIII1I;else{const iill1=Iii111['slice'](0x0,0x2),iii1l1=l1l1II[i1ii1(0x24a,'EeoT')](-0x2),IIliIl=Iil1I1[i1ii1(0x268,'Prgk')](lIli1l[i1ii1(0x223,'FuWK')](lIli1l[i1ii1(0x15d,'!vEv')](Ii1iII,iill1[i1ii1(0x1b4,'DK5H')]),iii1l1[i1ii1(0x188,'6obq')]),0x0),II11ll='*'[i1ii1(0x1d4,'BQsT')](IIliIl);return lIli1l[i1ii1(0x18c,'^brm')](iill1+II11ll,iii1l1);}}}console[i1ii1(0x19e,'FuWK')](lI1lil+i1ii1(0x22a,'$JlL')+iii1ii+'奖票');if(exchange){const liiI1I=exchange['indexOf']('@');if(liiI1I===-0x1){console[i1ii1(0x210,'Hb4B')](lI1lil+i1ii1(0x16c,'5^d0')),$[i1ii1(0x195,'jG8!')]=!![];return;}else{;[i1i11I,rewardTypeStr]=exchange['split']('@'),il1iIl=lIli1l[i1ii1(0x1a2,'lKSR')](parseInt,rewardTypeStr,0xa),await II11li('wanyiwan_exchange'),await $[i1ii1(0x1c1,'Nu)]')](parseInt($['waitTime']*0x1+0x1f4,0xa));}}else{if(lIli1l[i1ii1(0x201,'s@7H')]!==i1ii1(0x1ed,'v37p')){const lI1II1=lIli1l[i1ii1(0x16a,'Rtmm')](i1ili1,i1l1l1);lIli1l['nsoNV'](lI1II1,0x0)&&lIli1l['CROVG'](lI1II1,0x1)&&(II11Ii=lI1II1);}else{let i1ilII=IllIiI['filter'](iIIii1=>iIIii1['rewardType']==rewardType_map['京豆'])[i1ii1(0x1a7,'6obq')]((IllIi1,lilIII)=>{const llI111=i1ii1;if(lIli1l[llI111(0x151,'czvV')]('fLgoH','IPdfj'))return lilIII[llI111(0x1d9,'8IF1')]-IllIi1[llI111(0x168,'FuWK')];else II1Il=lilIlI;});for(let II11i1 of i1ilII){if(!II11i1[i1ii1(0x1b8,'n]bL')]||lIli1l[i1ii1(0x22b,'czvV')](iii1ii,II11i1[i1ii1(0x24d,'fObI')]))continue;il1iIi=II11i1['exchangeScore'],i1i11I=II11i1[i1ii1(0x23c,'aH53')],il1iIl=II11i1[i1ii1(0x23d,'s@7H')],await II11li(i1ii1(0x1a6,'Hb4B')),await $[i1ii1(0x1cc,'BQsT')](parseInt($[i1ii1(0x245,'v37p')]*0x1+0x1f4,0xa));}}}}}if($['runEnd'])return{'runEnd':!![]};await $[i1ii1(0x179,'jG8!')](parseInt(lIli1l['OPWxh'](lIli1l[i1ii1(0x1d1,'v37p')]($[i1ii1(0x200,'WWx8')],0x1),0x1f4),0xa));async function iii1il(iliIil,iliIii){const i1iIiI=i1ii1;if(lIli1l[i1iIiI(0x191,'LNQ4')]==='ojyBK'){lilii[i1iIiI(0x24b,']q]d')](l1iiI+i1iIiI(0x1ad,'FuWK')),ll1li[i1iIiI(0x1b1,'vNXR')]=!![];return;}else try{if(i1iIiI(0x227,'nf!u')!==lIli1l[i1iIiI(0x23b,'fObI')])i1l1ll=I1iIiI[i1iIiI(0x1c3,'Oqb1')]((iIIill,iilii)=>!lilIii['needRemoveCookieIndex'][i1iIiI(0x15e,'Oqb1')](iilii+0x1)),i1ilil[i1iIiI(0x1d6,'LNQ4')]=[];else switch(iliIil){case i1iIiI(0x218,'EeoT'):if(lIli1l[i1iIiI(0x18b,'5^d0')](iliIii[i1iIiI(0x1da,'DK5H')],0x0)){if(iliIii[i1iIiI(0x236,'jG8!')]&&iliIii['data'][i1iIiI(0x1ce,'Oqb1')]===0x0)Iil1l1=iliIii['data'][i1iIiI(0x1c0,'Hb4B')];else{let Ill11i=common[i1iIiI(0x1e3,'nf!u')](iliIii[i1iIiI(0x204,'8IF1')]);console['log'](lI1lil+'查询兑换页失败:\x20'+Ill11i);}}else{if(lIli1l['CQJkK'](lIli1l[i1iIiI(0x247,'8#&o')],i1iIiI(0x14a,'JLBr'))){let iilil=common['getErrorMsg'](iliIii);console['log'](lI1lil+'查询兑换页失败:\x20'+iilil);return;}else{let il1ll=Iiil1['getErrorMsg'](iiilli[i1iIiI(0x19c,'nf!u')]);l1iIIl['log'](iiilll+i1iIiI(0x1f3,'!vEv')+il1ll);}}break;case i1iIiI(0x224,'Rtmm'):if(lIli1l[i1iIiI(0x1a8,')0)3')](iliIii[i1iIiI(0x215,'TeYd')],0x0)){if(lIli1l[i1iIiI(0x1bb,'Hb4B')]===i1iIiI(0x240,'^brm')){let lill1l=l1iIIi[i1iIiI(0x270,'Oqb1')](lilIi);l1l11I['log'](lilIl+i1iIiI(0x184,'206s')+lill1l);return;}else{if(iliIii[i1iIiI(0x17f,'5^d0')]&&lIli1l[i1iIiI(0x155,'jwVR')](iliIii['data'][i1iIiI(0x25f,'v37p')],0x0)){let {rewardType:l1l1i1,rewardName:i1iiI}=iliIii[i1iIiI(0x220,'1N9u')][i1iIiI(0x265,'m%Pv')];iii1ii-=il1iIi;let i1ilIl=rewardType_table[l1l1i1]||'';console[i1iIiI(0x235,'czvV')](lI1lil+'兑换成功:\x20'+i1ilIl+i1iiI),i1l1iI[i1iIiI(0x241,'FuWK')](i1iIiI(0x25c,'5^d0')+i1ilIl+i1iiI);}else{if(lIli1l[i1iIiI(0x1e7,'JLBr')]===i1iIiI(0x14b,'TeYd')){let llI11I=common['getErrorMsg'](iliIii[i1iIiI(0x1b0,'^brm')]);console[i1iIiI(0x20a,'s@7H')](lI1lil+'兑换失败:\x20'+llI11I);}else lilIil['log'](i1iIiI(0x17b,'lrWR'));}}}else{if(i1iIiI(0x253,'206s')!=='EVxnA'){let iii1li=common[i1iIiI(0x256,'vNXR')](iliIii);console['log'](lI1lil+i1iIiI(0x203,'v37p')+iii1li);return;}else{let IIii11=llI[i1iIiI(0x1de,'JLBr')](llliI);iI1li1[i1iIiI(0x166,'WWx8')](lllii1+'兑换失败:\x20'+IIii11);return;}}break;}}catch(iliIl1){if(lIli1l[i1iIiI(0x1f0,'EeoT')]!==i1iIiI(0x150,'$JlL'))console['log'](i1iIiI(0x1b5,'jwVR')+iliIil+i1iIiI(0x17e,'0e*5')+(iliIl1['message']||iliIl1));else{let iii1ll=iI1llI[i1iIiI(0x26b,'6obq')](llliii[i1iIiI(0x1f4,'EeoT')]);IllI11['log'](l1llIi+i1iIiI(0x248,'EeoT')+iii1ll);}}}async function II11li(IIliI1){const IlllI1=i1ii1,il1lI={'xLnhg':lIli1l['YJIJG']};if($[IlllI1(0x15b,'DK5H')])return;let IliIIl='',I1il1l=null,lI1l1l=null,IIliII=IlllI1(0x251,'s@7H');switch(IIliI1){case IlllI1(0x260,'gq1D'):IliIIl=lIli1l['MiaPu'],I1il1l={'functionId':IIliI1,'body':JSON[IlllI1(0x16b,'m%Pv')]({'version':0x1}),'rfs':IlllI1(0x1cf,'aH53'),'appid':IlllI1(0x1bf,'p0Yp'),'t':Date[IlllI1(0x1eb,'v37p')](),'client':lIli1l[IlllI1(0x18e,']q]d')],'clientVersion':common[IlllI1(0x230,'DK5H')]()};break;case lIli1l['meDJt']:IliIIl=IlllI1(0x1bd,'fTuH'),I1il1l={'functionId':IIliI1,'body':JSON[IlllI1(0x1ee,'!vEv')]({'assignmentId':i1i11I,'type':il1iIl,'version':0x1}),'rfs':lIli1l[IlllI1(0x197,'^brm')],'appid':lIli1l[IlllI1(0x254,'fObI')],'t':Date[IlllI1(0x19f,'s%LQ')](),'client':lIli1l['zkOTP'],'clientVersion':common[IlllI1(0x1ae,'2fmN')]()};break;default:console[IlllI1(0x183,'8IF1')](IlllI1(0x238,'s%LQ')+IIliI1);return;}const iiliI={};I1il1l&&(lIli1l[IlllI1(0x16d,'2fmN')]===lIli1l['lRBKb']?(delete IlIllI['data'],delete il1i1I[IlllI1(0x170,'q1q(')][il1lI[IlllI1(0x193,'nf!u')]]):Object['assign'](I1il1l,iiliI));lI1l1l&&Object['assign'](lI1l1l,iiliI);const Ill11I={'url':IliIIl,'method':IIliII,'headers':{'origin':lIli1l[IlllI1(0x1c4,'s%LQ')],'Referer':lIli1l[IlllI1(0x225,'scX3')],'User-Agent':lI1lii,'Cookie':II1iI,'content-type':IlllI1(0x261,'n]bL'),'accept':IlllI1(0x19b,'m%Pv'),'x-rp-client':IlllI1(0x163,'Hb4B')},'params':lI1l1l,'data':I1il1l,'timeout':0x7530};IIliII===IlllI1(0x1b3,'jG8!')&&(delete Ill11I[IlllI1(0x204,'8IF1')],delete Ill11I['headers'][IlllI1(0x1bc,'1N9u')]);const I1il1i=0x1;let IliIIi=0x0,lI1l1i=null;while(IliIIi<I1il1i){IliIIi>0x0&&await $['wait'](0x3e8);const llI11l=await common[IlllI1(0x250,'gq1D')](Ill11I);if(!llI11l[IlllI1(0x189,'v37p')]){if('pfqwA'==='kPRyn')iii1I1=0x1;else{lI1l1i='🚫\x20'+IIliI1+IlllI1(0x1d2,'LNQ4')+llI11l[IlllI1(0x1c6,'FuWK')],IliIIi++;continue;}}if(!llI11l[IlllI1(0x1fd,'lrWR')]){lI1l1i=IlllI1(0x25d,']q]d')+IIliI1+IlllI1(0x23f,'WWx8'),IliIIi++;continue;}await iii1il(IIliI1,llI11l[IlllI1(0x17f,'5^d0')]);break;}if(IliIIi>=I1il1i){if(lIli1l[IlllI1(0x1f5,'fTuH')](lIli1l[IlllI1(0x1aa,'m%Pv')],IlllI1(0x20c,'FuWK')))console[IlllI1(0x20b,'BQsT')](lI1l1i);else{Illl1i=!![];for(let I1llIi of iillli){const IIii1I=I1llIi[IlllI1(0x1d5,'Nu)]')]||'',llI11i=I1llIi[IlllI1(0x1ba,'Hb4B')]||0x0,i1iIi1=I1llIi[IlllI1(0x25b,'nf!u')]||0x0,l1l1il=I1llIi[IlllI1(0x237,'Rtmm')]||0x0,I11i1I=I1llIi[IlllI1(0x21a,'fTuH')],iliIi1=I1llIi[IlllI1(0x1b2,'0e*5')];if(i1iIi1!==0x2){const l1l1ii=llIlil?'-兑换值:'+llI11i+'@'+i1iIi1:'';IIlil+='\x20\x20'+IIii1I+'['+(I11i1I?'热门':'一般')+']-'+l1l1il+IlllI1(0x243,'n]bL')+(iliIi1?IlllI1(0x18d,'v37p'):'无库存')+l1l1ii+'\x0a';}}l1lIil[IlllI1(0x177,'Rtmm')](IlllI1(0x185,'6obq')+IiiIli);}}}}var version_ = 'jsjiami.com.v7';
// prettier-ignore
function Env(t,e){"undefined"!=typeof process&&JSON.stringify(process.env).indexOf("GITHUB")>-1&&process.exit(0);class s{constructor(t){this.env=t}send(t,e="GET"){t="string"==typeof t?{url:t}:t;let s=this.get;return"POST"===e&&(s=this.post),new Promise((e,i)=>{s.call(this,t,(t,s,r)=>{t?i(t):e(s)})})}get(t){return this.send.call(this.env,t)}post(t){return this.send.call(this.env,t,"POST")}}return new class{constructor(t,e){this.name=t,this.http=new s(this),this.data=null,this.dataFile="box.dat",this.logs=[],this.isMute=!1,this.isNeedRewrite=!1,this.logSeparator="\n",this.startTime=(new Date).getTime(),Object.assign(this,e),this.log("",`🔔${this.name}, 开始!`)}isNode(){return"undefined"!=typeof module&&!!module.exports}isQuanX(){return"undefined"!=typeof $task}isSurge(){return"undefined"!=typeof $httpClient&&"undefined"==typeof $loon}isLoon(){return"undefined"!=typeof $loon}toObj(t,e=null){try{return JSON.parse(t)}catch{return e}}toStr(t,e=null){try{return JSON.stringify(t)}catch{return e}}getjson(t,e){let s=e;const i=this.getdata(t);if(i)try{s=JSON.parse(this.getdata(t))}catch{}return s}setjson(t,e){try{return this.setdata(JSON.stringify(t),e)}catch{return!1}}getScript(t){return new Promise(e=>{this.get({url:t},(t,s,i)=>e(i))})}runScript(t,e){return new Promise(s=>{let i=this.getdata("@chavy_boxjs_userCfgs.httpapi");i=i?i.replace(/\n/g,"").trim():i;let r=this.getdata("@chavy_boxjs_userCfgs.httpapi_timeout");r=r?1*r:20,r=e&&e.timeout?e.timeout:r;const[o,h]=i.split("@"),n={url:`http://${h}/v1/scripting/evaluate`,body:{script_text:t,mock_type:"cron",timeout:r},headers:{"X-Key":o,Accept:"*/*"}};this.post(n,(t,e,i)=>s(i))}).catch(t=>this.logErr(t))}loaddata(){if(!this.isNode())return{};{this.fs=this.fs?this.fs:require("fs"),this.path=this.path?this.path:require("path");const t=this.path.resolve(this.dataFile),e=this.path.resolve(process.cwd(),this.dataFile),s=this.fs.existsSync(t),i=!s&&this.fs.existsSync(e);if(!s&&!i)return{};{const i=s?t:e;try{return JSON.parse(this.fs.readFileSync(i))}catch(t){return{}}}}}writedata(){if(this.isNode()){this.fs=this.fs?this.fs:require("fs"),this.path=this.path?this.path:require("path");const t=this.path.resolve(this.dataFile),e=this.path.resolve(process.cwd(),this.dataFile),s=this.fs.existsSync(t),i=!s&&this.fs.existsSync(e),r=JSON.stringify(this.data);s?this.fs.writeFileSync(t,r):i?this.fs.writeFileSync(e,r):this.fs.writeFileSync(t,r)}}lodash_get(t,e,s){const i=e.replace(/\[(\d+)\]/g,".$1").split(".");let r=t;for(const t of i)if(r=Object(r)[t],void 0===r)return s;return r}lodash_set(t,e,s){return Object(t)!==t?t:(Array.isArray(e)||(e=e.toString().match(/[^.[\]]+/g)||[]),e.slice(0,-1).reduce((t,s,i)=>Object(t[s])===t[s]?t[s]:t[s]=Math.abs(e[i+1])>>0==+e[i+1]?[]:{},t)[e[e.length-1]]=s,t)}getdata(t){let e=this.getval(t);if(/^@/.test(t)){const[,s,i]=/^@(.*?)\.(.*?)$/.exec(t),r=s?this.getval(s):"";if(r)try{const t=JSON.parse(r);e=t?this.lodash_get(t,i,""):e}catch(t){e=""}}return e}setdata(t,e){let s=!1;if(/^@/.test(e)){const[,i,r]=/^@(.*?)\.(.*?)$/.exec(e),o=this.getval(i),h=i?"null"===o?null:o||"{}":"{}";try{const e=JSON.parse(h);this.lodash_set(e,r,t),s=this.setval(JSON.stringify(e),i)}catch(e){const o={};this.lodash_set(o,r,t),s=this.setval(JSON.stringify(o),i)}}else s=this.setval(t,e);return s}getval(t){return this.isSurge()||this.isLoon()?$persistentStore.read(t):this.isQuanX()?$prefs.valueForKey(t):this.isNode()?(this.data=this.loaddata(),this.data[t]):this.data&&this.data[t]||null}setval(t,e){return this.isSurge()||this.isLoon()?$persistentStore.write(t,e):this.isQuanX()?$prefs.setValueForKey(t,e):this.isNode()?(this.data=this.loaddata(),this.data[e]=t,this.writedata(),!0):this.data&&this.data[e]||null}initGotEnv(t){this.got=this.got?this.got:require("got"),this.cktough=this.cktough?this.cktough:require("tough-cookie"),this.ckjar=this.ckjar?this.ckjar:new this.cktough.CookieJar,t&&(t.headers=t.headers?t.headers:{},void 0===t.headers.Cookie&&void 0===t.cookieJar&&(t.cookieJar=this.ckjar))}get(t,e=(()=>{})){t.headers&&(delete t.headers["Content-Type"],delete t.headers["Content-Length"]),this.isSurge()||this.isLoon()?(this.isSurge()&&this.isNeedRewrite&&(t.headers=t.headers||{},Object.assign(t.headers,{"X-Surge-Skip-Scripting":!1})),$httpClient.get(t,(t,s,i)=>{!t&&s&&(s.body=i,s.statusCode=s.status),e(t,s,i)})):this.isQuanX()?(this.isNeedRewrite&&(t.opts=t.opts||{},Object.assign(t.opts,{hints:!1})),$task.fetch(t).then(t=>{const{statusCode:s,statusCode:i,headers:r,body:o}=t;e(null,{status:s,statusCode:i,headers:r,body:o},o)},t=>e(t))):this.isNode()&&(this.initGotEnv(t),this.got(t).on("redirect",(t,e)=>{try{if(t.headers["set-cookie"]){const s=t.headers["set-cookie"].map(this.cktough.Cookie.parse).toString();s&&this.ckjar.setCookieSync(s,null),e.cookieJar=this.ckjar}}catch(t){this.logErr(t)}}).then(t=>{const{statusCode:s,statusCode:i,headers:r,body:o}=t;e(null,{status:s,statusCode:i,headers:r,body:o},o)},t=>{const{message:s,response:i}=t;e(s,i,i&&i.body)}))}post(t,e=(()=>{})){if(t.body&&t.headers&&!t.headers["Content-Type"]&&(t.headers["Content-Type"]="application/x-www-form-urlencoded"),t.headers&&delete t.headers["Content-Length"],this.isSurge()||this.isLoon())this.isSurge()&&this.isNeedRewrite&&(t.headers=t.headers||{},Object.assign(t.headers,{"X-Surge-Skip-Scripting":!1})),$httpClient.post(t,(t,s,i)=>{!t&&s&&(s.body=i,s.statusCode=s.status),e(t,s,i)});else if(this.isQuanX())t.method="POST",this.isNeedRewrite&&(t.opts=t.opts||{},Object.assign(t.opts,{hints:!1})),$task.fetch(t).then(t=>{const{statusCode:s,statusCode:i,headers:r,body:o}=t;e(null,{status:s,statusCode:i,headers:r,body:o},o)},t=>e(t));else if(this.isNode()){this.initGotEnv(t);const{url:s,...i}=t;this.got.post(s,i).then(t=>{const{statusCode:s,statusCode:i,headers:r,body:o}=t;e(null,{status:s,statusCode:i,headers:r,body:o},o)},t=>{const{message:s,response:i}=t;e(s,i,i&&i.body)})}}time(t,e=null){const s=e?new Date(e):new Date;let i={"M+":s.getMonth()+1,"d+":s.getDate(),"H+":s.getHours(),"m+":s.getMinutes(),"s+":s.getSeconds(),"q+":Math.floor((s.getMonth()+3)/3),S:s.getMilliseconds()};/(y+)/.test(t)&&(t=t.replace(RegExp.$1,(s.getFullYear()+"").substr(4-RegExp.$1.length)));for(let e in i)new RegExp("("+e+")").test(t)&&(t=t.replace(RegExp.$1,1==RegExp.$1.length?i[e]:("00"+i[e]).substr((""+i[e]).length)));return t}msg(e=t,s="",i="",r){const o=t=>{if(!t)return t;if("string"==typeof t)return this.isLoon()?t:this.isQuanX()?{"open-url":t}:this.isSurge()?{url:t}:void 0;if("object"==typeof t){if(this.isLoon()){let e=t.openUrl||t.url||t["open-url"],s=t.mediaUrl||t["media-url"];return{openUrl:e,mediaUrl:s}}if(this.isQuanX()){let e=t["open-url"]||t.url||t.openUrl,s=t["media-url"]||t.mediaUrl;return{"open-url":e,"media-url":s}}if(this.isSurge()){let e=t.url||t.openUrl||t["open-url"];return{url:e}}}};if(this.isMute||(this.isSurge()||this.isLoon()?$notification.post(e,s,i,o(r)):this.isQuanX()&&$notify(e,s,i,o(r))),!this.isMuteLog){let t=["","==============📣系统通知📣=============="];t.push(e),s&&t.push(s),i&&t.push(i),console.log(t.join("\n")),this.logs=this.logs.concat(t)}}log(...t){t.length>0&&(this.logs=[...this.logs,...t]),console.log(t.join(this.logSeparator))}logErr(t,e){const s=!this.isSurge()&&!this.isQuanX()&&!this.isLoon();s?this.log("",`❗️${this.name}, 错误!`,t.stack):this.log("",`❗️${this.name}, 错误!`,t)}wait(t){return new Promise(e=>setTimeout(e,t))}done(t={}){const e=(new Date).getTime(),s=(e-this.startTime)/1e3;this.log("",`🔔${this.name}, 结束! 🕛 ${s} 秒`),this.log(),(this.isSurge()||this.isQuanX()||this.isLoon())&&$done(t)}}(t,e)}

const fs = require("fs");
const vm = new Env('更新Cookies');

if (process.env.JD_DEBUG && process.env.JD_DEBUG === 'false') console.log = () => {
};
let JD_PT_PIN = process.env.JD_PT_PIN ? process.env.JD_PT_PIN : "";
if (!JD_PT_PIN || JD_PT_PIN === "") {
    vm.msg(vm.name, 'pt_pin为空,停止更新cookies');
    return;
}

//这个自己去抓 genToken
// @formatter:off
const defaultEps = [{"area":"CtPpCJqyD18mXzK=","d_model":"JJSmCNPACuU=","wifiBssid":"CJO=","osVersion":"CJO=","d_brand":"WQvrb21f","screen":"CtSmDsenCNqm","uuid":"YJrrCtvzZNHrDQC3YWC0DG==","aid":"YJrrCtvzZNHrDQC3YWC0DG==","openudid":"YJrrCtvzZNHrDQC3YWC0DG=="},{"area":"CtPpCJqyD18mXzK=","d_model":"HUnPBUPCCNK=","wifiBssid":"CJO=","osVersion":"CJK=","d_brand":"IPVLV0VT","screen":"CtS2DIenCNqm","uuid":"DQC0CWG5DNC2YJOyCtHrYm==","aid":"DQC0CWG5DNC2YJOyCtHrYm==","openudid":"DQC0CWG5DNC2YJOyCtHrYm=="},{"area":"CtPpCJqyD18mXzK=","d_model":"Uu1YCtOyCG==","wifiBssid":"CJO=","osVersion":"CJK=","d_brand":"cwVrbQ1v","screen":"CtO2CIenCNqm","uuid":"EJvrYJU0CzOyCQVuDNq4EK==","aid":"EJvrYJU0CzOyCQVuDNq4EK==","openudid":"EJvrYJU0CzOyCQVuDNq4EK=="},{"area":"CJvpCJYmCV8mXzK=","d_model":"UwVubWvBCzLGcw8=","wifiBssid":"CJO=","osVersion":"CJO=","d_brand":"WQvrb21f","screen":"CtC1DsenCNqm","uuid":"ZtTrDzY4YzC2DtrvCwZuZK==","aid":"ZtTrDzY4YzC2DtrvCwZuZK==","openudid":"ZtTrDzY4YzC2DtrvCwZuZK=="},{"area":"CtPpCJqyD18mXzK=","d_model":"U00jJtu3Du4=","wifiBssid":"CJO=","osVersion":"CJO=","d_brand":"c2Pjc3VkZm==","screen":"CtuyDyenDNGm","uuid":"YwS4Ctu2CzG1ZwPsDJc3DK==","aid":"YwS4Ctu2CzG1ZwPsDJc3DK==","openudid":"YwS4Ctu2CzG1ZwPsDJc3DK=="},{"area":"CtPpCJqyD18mXzK=","d_model":"JWunCK==","wifiBssid":"CJO=","osVersion":"CJO=","d_brand":"WQvrb21f","screen":"CtSmDsenCNqm","uuid":"YzO0DwO3ZJYzDNU5CNvwEG==","aid":"YzO0DwO3ZJYzDNU5CNvwEG==","openudid":"YzO0DwO3ZJYzDNU5CNvwEG=="},{"area":"CtPpCJqyD18mXzK=","d_model":"UwVubWvBCzLGcw8=","wifiBssid":"CJO=","osVersion":"CJO=","d_brand":"WQvrb21f","screen":"CtC1DsenCNqm","uuid":"ZtTrDzY4ZNC0CNumZJTwZQG=","aid":"ZtTrDzY4ZNC0CNumZJTwZQG=","openudid":"ZtTrDzY4ZNC0CNumZJTwZQG="},{"area":"CzPpCtY1Cv8zDtY4Dv81CtY4Dq==","d_model":"JJSnCNTBCUC=","wifiBssid":"dW5hbw93bq==","osVersion":"CJO=","d_brand":"WQvrb21f","screen":"CzKmDyenDNGm","uuid":"CQU3CzPrY2G2DtrvCQZsDG==","aid":"CQU3CzPrY2G2DtrvCQZsDG==","openudid":"CQU3CzPrY2G2DtrvCQZsDG=="}];
// @formatter:on

let random = (min, max) => {
    return Math.floor(Math.random() * (max - min)) + min;
}

/**
 * 格式化时间
 * @param fmt
 * @param date
 * @returns {*}
 */
let dateFormat = (fmt, date) => {
    let ret = '';
    const opt = {
        "Y+": date.getFullYear().toString(),        // 年
        "m+": (date.getMonth() + 1).toString(),     // 月
        "d+": date.getDate().toString(),            // 日
        "H+": date.getHours().toString(),           // 时
        "M+": date.getMinutes().toString(),         // 分
        "S+": date.getSeconds().toString()          // 秒
        // 有其他格式化字符需求可以继续添加，必须转化成字符串
    };
    for (let k in opt) {
        ret = new RegExp("(" + k + ")").exec(fmt);
        if (ret) {
            fmt = fmt.replace(ret[1], (ret[1].length === 1) ? (opt[k]) : (opt[k].padStart(ret[1].length, "0")))
        }
    }
    return fmt;
}

let globalOptions = {
    message: '',
    debug: false,
    debugSign: "",
    clientVersion: "10.2.2",
    osVersion: "11",
    screen: {width: 1080, height: 2206},
    successCount: 0,
    accountsList: [],
    signJsonFileCount: 50,
    signList: [],
    signServerUrl: "",
    curEp: null,
    firstEp: null,
    curUuid: "",
}

globalOptions.curEp = defaultEps[random(0, defaultEps.length - 1)];

const globalConfig = {
    configShPath: "../config/config.sh",
    accountPath: "../config/account.json",
    signPath: "./.sign/",
}
const getUa = () => {
    return `okhttp/3.12.1;jdmall;android;version/${globalOptions.clientVersion};build/91077;screen/${globalOptions.screen.width}x${globalOptions.screen.height};os/${globalOptions.osVersion};network/wifi;`
}
const loadAccount = () => {
    try {
        fs.accessSync(globalConfig.accountPath)
        globalOptions.accountsList = JSON.parse(fs.readFileSync(globalConfig.accountPath).toString())
    } catch (e) {
    }
}
const loadLocalSign = () => {
    let signFile = `${globalConfig.signPath}/${globalOptions.clientVersion}/${(random(1, globalOptions.signJsonFileCount))}.json`;
    try {
        fs.accessSync(signFile)
        globalOptions.signList = JSON.parse(fs.readFileSync(signFile).toString())
    } catch (e) {
        console.log("签名文件加载失败")
    }
}


// @formatter:off
///----------------------
var iｉl='jsjiami.com.v6',i1l1i=[iｉl,'LE7ClMKIGTjCuyzDo8O2w4nDpcO8wqVgwoDDs8Ocw5BCwq3Crmhbwo3DrzxRNwVLwqBww4DCqWDDv0w1HcOBMMKqw7czMMKdwrbDtzLDpE3CuinCqQ==','w7nDgMKxwqRFCw==','wppKworDvCrCmQ==','w5MrEWnCsS0=','w5LCusODw55QCg==','wq1pJMKrcQ==','NMO+UmvDkCM=','VC91OnNi','w4nCix/Ds8Oxw4o=','GcKSesO3wrXDgg==','wqfDkSI5EQ==','w6otw7hHw6od','EcKCw4vCkQzDtg==','w7Z6wqHDnQ==','wrEsEsKJeMK2','w7vCkMOtwqg=','IWjCrsKew6nCqQ==','wr1CwovDkA==','RsO2fMKxLA==','wr8Swo/DvA/DhA==','QMOjT8KvLAE=','Pk3Cj8O6E8KHwr9w','wrvDpGtgwrPCjMOOHWU=','w7XDskxtw63Dlg==','dg4aZ8O/bQ==','w7fDosOGw55wDw==','wr1cI8OwWC8=','wp7DksKVSjw=','JcOdw4BvwpDDrg==','U1ZHP8KHaA==','bcKIw48e','w5ImHw==','U8OiYsKRPBEN','cksCJsK9O8OowoPCm8ORw5sFwqTCq2PCnTAKBDBxPsKfCMOPbzvDosO/eMOdwqnDvUvDsMK3I8O9wqfDlFdJw5dvwrnDtRN6w680KgQyVUjCicKVwowAwrdMZsKHP8KHZMK3w6QNw6zClMOUYcK/ZQ7ClmbDu8OmDT7CsGHCo8KCZ8O9wpknDiPDt0V9wpDDisKKw51bXMO4cTdbOi7Cv8KlAMKMeMKtwpZ6NGxvw4BzHDTDozUdDh5tw5LDtcKRZsK9w6IzI8Ohw5XDm33DnTDDpjnDjMOzGwTCk8KMCcKODMKrbMOeYy0iUyfDkMOBwoc8JnY1woRqwqjDqcODXEZnfsKyD8OCw7rDlcOhwr/DkhXCn8OGMw==','wpkBNEnDpS8mIsKbwpvCnMOQwok8wqTCmsKhVcOvwpdjajhN','wpR9FQ==','wrDCskIrw5TDq8Ocwq1lwrXCqH4=','wrLDqDDChUxY','d8K9FA==','EMKOD0rCnsKY','w7YLMUzDqQ==','OsKCwp42RxHCkRvClmUEZEk=','COett+WTleiuj+awlOWki+i2r++/qeiug+eojOWSrOWEqeisgg==','PS3DgMKHwrHCjg==','wp/Dk3fCpw==','woLDlAIcTHM=','wr3Ci2JMwojCjA==','bsKAw5oDwps=','aQzDisOMUsKn','w7fDosOGw551Kg==','w4wLP07DjCghaw==','w5YrNEnCsXA=','wrvCisKVajk=','InXClsKAw4zCrmVi','w5fDp8OGw551Kg==','w5zCmMOpwqEY','PS3CmMKCwrHDtg==','YsKGwo0ywo/CrCfCqA==','PcOlbcK7w4DCvMOjOA==','wqnCqjLCjARU','OcKXw6g8','w7LClMO0woAbVDbCtQ==','wp9xUFdTwqNm','w5lfw6rDusOjf8OxGw==','w6UAGg==','J8KGJH1JYMOM','wprDlxghUnNVLg==','wqNCwpTDhiM=','w6jCucOe','wpDDrz3DmA==','CUnCrMKPw7J+w6E/Tw==','wrPCpsKv','YFPCmA==','HMKYw48e','OcKNw5tVwrw=','ImnCk8Kdw7TCtQ==','wp/CjMKYZg==','woM2wrs=','WGjCvA==','OcO3XFfDmxzDtMKjbg==','w4zCizrDk8OxwrI=','N8KQD1JNbQ==','wogxJMKOVA==','w48xwprDn8KsAg==','wr3CqxpMw5U=','wrgIIcOe','GHDCmMKHw6nCrg==','wrpPworChHfDoQ==','w7EqwqXDlCHCnA==','wrEtPsKK','wpvDksK1Sjw=','OcKZw5pO','AMKiwrARJT0=','LcOnTUo=','wqfDkSJkESs=','EMKODxfCnsKY','w5zCmMOsw7w9Cw==','w7Mxw6JD','DsOrNsKawovDiQ==','OcO/TcKn','UXJ1QlZH','wpjCixo0w7DCjA==','dUjCiMON','w6nCq0LDs8KJwrI=','wrrCi1LDnyIx','w7YLaUnDiQg=','WHzCqxA=','McKjUhPDtQY=','AMKuZcO2','wrjDvlFMwq3Clg==','bsKUw5sY','wppPwo/DnCrDhA==','wotgVnpcwrA=','w6pJWC9p','wrjCrkJMw7DDtA==','wo88w4gdw4TDnA==','wrjDslNiwrXClw==','wox7d2dAwr5tw6E=','wrxYOcO0RA==','GHXCmMOfwrHCjg==','G8KOw4nCgh3DrA==','O0bDi8OJQzDDvCDCpA==','bcKRw4QZwoo=','w4xidMKGVcOIw5Z9','w43Dp8ODw7R8','McO3UEXDiCc=','CMOQMFLCpcK4SMO7','bEjClMOYMiTCri7Dk8K8wp7DgQ==','csKowpk5wpLDug==','TlLCu8Olw4Jq','TMKPwpAWwozCiw==','EMKOw5M=','wrElSH9bwrs=','wp3CplFpwqjClg==','w7odMnQeBw==','L8KZwpY1VxzCgh/CsHg1cw==','w4FZw5XDh8O4eg==','w5rDhT0ISAQ=','RGzCth8iUg==','w7d+QsOmMEE=','dlM/OsKiSA==','FlTCssKvw7V1','wpzCqHAGScKe','w6BYPzEHHQ==','wr8SworDvCrDoQ==','wogxJMKrccO+','AMKiwpUxJQ==','w4TCnsKMw4ZGYg==','V8KIw4E5wpLCog==','w6HCssOTw41bQw==','wpzDtVBbacKe','PS3CncKnw6zDtg==','AMKCwpU0fUU=','U3YaP8O/','w6QBw5XCv8OYeg==','wp/DllLCgloR','FnTCl8KPw7V1','wpQlSFpbwr4=','w6nCqxrDk8KswrI=','KMOAw7dkwq8+','w5UNMU4=','HsOaw47CiQDDrQ==','w4p1w70aw48d','wozCqjLDkQQM','JcKHwrA0fR0=','w4R5w7DDh8OYJw==','OsKYw4hSwqzDsQ==','FlHCl8KKw7V1','wrvCqsKQajk=','U1YfH8KibQ==','AMKlw4VPwrA=','HMKbw49qwqdQ','KMKdwo88wo9j','w6nCqx/DtsKpw4o=','dCp1H3ZH','woLDsQI8SXM=','wqzDkmrCjFkM','FlHDr8KPw5U=','LsO7JXN6Hg==','w5rDhT1wbVk=','wqfCiSdkaVM=','cw4aZ8KibQ==','w7Z0wqzDpsKsJQ==','IWnCgsKG','w6oUeC80Vw==','MMOzTg==','w6HCvsKMw6Me','IsOvR8K8','wpF4bSJewr4=','wqocw4hlwrw=','wqUAwotpw70=','U8OiYsKBOQ==','O8O7TFHDiArDrQ==','w6nDrkxl','wo3DjTkAVXNf','wqAxKQ==','w61uwqXDnA==','YkTDoT5nQ8O9wrAkdsOEw4jCoRPDtxLDjcOmTMKcwozCgWgkUH3DlXXDr8OYHcOPw7cRwp0Aw4RBc2LDqsOLGXE=','FMO7Uk7DlSM=','w4wxwrfDhsKrC30veA==','McKjUmvDkCY=','MnPCnMOAw6rCrnhxFMOkZEV6w4HChXnCosK+GMKXw74=','5o+45Y2x6LC955SK6Zal6K6g','w6fCqylc','RsObwp/DlQ==','R3rCjh0kScOjwooa','wrxQwrDDkDTDm8KPCMKh','E8OMNUPCpcKiT8Ozw6Y=','A8K4ZMO7w6HDpQ==','JcKAwphPw6g=','wp3DmzkwRXQ=','VHJwH3Zi','NcO2UkrCvsK9','K8KTbsOHw5PDrA==','dAp1Gi5i','TAzCksOsCsOf','IMKCw41DwqHDjcKZ','w6bCgcOswqQA','wr3CrkJsw5XDtA==','w4TCnsORw4Zm','wqXDmUzCiw4W','M8KAIlxNeg==','FMOaCkHCv8Kl','wqnDsjfCqVwM','wpPCk8KVLTjCs3TDjw5seRQ=','wqNGeQ==','AMOmV8KGwoPCvA==','JcKAwphPwrA=','FMObUkvCjX4=','wrF4SFp7wp4=','wpXChsKI','w7DCqkxowrA=','w5MgwqvDiMKxBA==','w5PCrhrDucKl','w5MLNEnCsQ==','wpjCrkdMw7DCrA==','wqBPwo/DliM=','wpzDtXUjScOD','KMKdwq9Ew5dj','wrrDllfChwIU','wp8CwonCuA==','eMOcwpEW','w7R3woXDlCTDpA==','HsKHw47CrCDDjQ==','w68ow7hCw69F','w5zCmMOpwqRF','PVXCuMKHw6zCrg==','w7oANG44ETTDiRhqGsO0QA==','w7/CvT1VbQ==','aVTCl8OMKg==','wrI7P8KHeMKh','wpvCjcKYZi3Dkng=','wrUWwotJw6jCgw==','HMOPw4hkwpo=','wqbDumsPZcOB','D8OcEUPCssK/','wrlcJMOwRDM=','Tip+HUxrB1wEw5BXw5EU','OcKSw41hw6IJ','w7R0wqs=','D8OWBEjChMK0VMOqw63DsCbCqMOK','w7HnrYflkYDoraDmsa7lpbbotbTvvZrorLznqIrlkqflhoforZk=','L8O4UcKiw7HCvcOsLQJSw4Yk','AMOdw4BKwpDDrg==','w5RiQMK3VcOT','w7/DhWBQSHw=','wr3Crhppw7A=','DsOrNsOCw5M=','wohpIcKOccKG','JMOrTg==','wogRIcKOdA==','DsOrNsOCw5Y=','OsKFw45IwpXDq8KMw48=','IMOmUsO+woPDpA==','eV/Cj8KYEiPCoDfDucK2w5fDlMK4w6VVw4DCsw==','w4TCu8OUw4NDGg==','wrTDqWkGacOMwqQXd8O9wpdYw7DCviPDjWLDkMOHK8KWw4ERSFDCnkwOwrbCsMKDw6t1','f1XDlsOGDQ==','acOSwpA2wqnCrg==','BcK/Kw==','cksCJsK9O8OowoPCj8OPwpxGw6fDr23Dl30GBnI9OsKaTMOIaCHDo8O/a8OZw6/Ds1XCv8K7O8Ojw7vDlFFNw5xIwpbCrQ0i','jsjzUirRaYYTOFmETzMi.QcYom.vT6=='];(function(_0x5c5f54,_0x3c2786,_0x2db158){var _0x43c762=function(_0x24c4ce,_0x3ccbe1,_0xc6df84,_0x5eaaaa,_0x2396a6){_0x3ccbe1=_0x3ccbe1>>0x8,_0x2396a6='po';var _0x1b0ba7='shift',_0x18cdc1='push';if(_0x3ccbe1<_0x24c4ce){while(--_0x24c4ce){_0x5eaaaa=_0x5c5f54[_0x1b0ba7]();if(_0x3ccbe1===_0x24c4ce){_0x3ccbe1=_0x5eaaaa;_0xc6df84=_0x5c5f54[_0x2396a6+'p']();}else if(_0x3ccbe1&&_0xc6df84['replace'](/[zUrRYYTOFETzMQYT=]/g,'')===_0x3ccbe1){_0x5c5f54[_0x18cdc1](_0x5eaaaa);}}_0x5c5f54[_0x18cdc1](_0x5c5f54[_0x1b0ba7]());}return 0xb2836;};return _0x43c762(++_0x3c2786,_0x2db158)>>_0x3c2786^_0x2db158;}(i1l1i,0x16d,0x16d00));var Iil1Il=function(_0x454ead,_0x5265b3){_0x454ead=~~'0x'['concat'](_0x454ead);var _0x28abc2=i1l1i[_0x454ead];if(Iil1Il['lIIiIi']===undefined){(function(){var _0x15562b;try{var _0x23c07b=Function('return\x20(function()\x20'+'{}.constructor(\x22return\x20this\x22)(\x20)'+');');_0x15562b=_0x23c07b();}catch(_0x5063d9){_0x15562b=window;}var _0x39531a='ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=';_0x15562b['atob']||(_0x15562b['atob']=function(_0x104d89){var _0x314d55=String(_0x104d89)['replace'](/=+$/,'');for(var _0x403076=0x0,_0x3d32fd,_0x3332fe,_0x27d566=0x0,_0x490524='';_0x3332fe=_0x314d55['charAt'](_0x27d566++);~_0x3332fe&&(_0x3d32fd=_0x403076%0x4?_0x3d32fd*0x40+_0x3332fe:_0x3332fe,_0x403076++%0x4)?_0x490524+=String['fromCharCode'](0xff&_0x3d32fd>>(-0x2*_0x403076&0x6)):0x0){_0x3332fe=_0x39531a['indexOf'](_0x3332fe);}return _0x490524;});}());var _0x135319=function(_0x4aa773,_0x5265b3){var _0x5264ce=[],_0x4499c0=0x0,_0x2136de,_0x5910ca='',_0x53ec72='';_0x4aa773=atob(_0x4aa773);for(var _0x218e13=0x0,_0x2b01b1=_0x4aa773['length'];_0x218e13<_0x2b01b1;_0x218e13++){_0x53ec72+='%'+('00'+_0x4aa773['charCodeAt'](_0x218e13)['toString'](0x10))['slice'](-0x2);}_0x4aa773=decodeURIComponent(_0x53ec72);for(var _0xfc16de=0x0;_0xfc16de<0x100;_0xfc16de++){_0x5264ce[_0xfc16de]=_0xfc16de;}for(_0xfc16de=0x0;_0xfc16de<0x100;_0xfc16de++){_0x4499c0=(_0x4499c0+_0x5264ce[_0xfc16de]+_0x5265b3['charCodeAt'](_0xfc16de%_0x5265b3['length']))%0x100;_0x2136de=_0x5264ce[_0xfc16de];_0x5264ce[_0xfc16de]=_0x5264ce[_0x4499c0];_0x5264ce[_0x4499c0]=_0x2136de;}_0xfc16de=0x0;_0x4499c0=0x0;for(var _0x5487eb=0x0;_0x5487eb<_0x4aa773['length'];_0x5487eb++){_0xfc16de=(_0xfc16de+0x1)%0x100;_0x4499c0=(_0x4499c0+_0x5264ce[_0xfc16de])%0x100;_0x2136de=_0x5264ce[_0xfc16de];_0x5264ce[_0xfc16de]=_0x5264ce[_0x4499c0];_0x5264ce[_0x4499c0]=_0x2136de;_0x5910ca+=String['fromCharCode'](_0x4aa773['charCodeAt'](_0x5487eb)^_0x5264ce[(_0x5264ce[_0xfc16de]+_0x5264ce[_0x4499c0])%0x100]);}return _0x5910ca;};Iil1Il['liI1iI']=_0x135319;Iil1Il['iI1Il1']={};Iil1Il['lIIiIi']=!![];}var _0x1e5ae8=Iil1Il['iI1Il1'][_0x454ead];if(_0x1e5ae8===undefined){if(Iil1Il['i1iIl1']===undefined){Iil1Il['i1iIl1']=!![];}_0x28abc2=Iil1Il['liI1iI'](_0x28abc2,_0x5265b3);Iil1Il['iI1Il1'][_0x454ead]=_0x28abc2;}else{_0x28abc2=_0x1e5ae8;}return _0x28abc2;};let ii1I11=new Array(0x80),liIi1=['K','L','M','N','O','P','Q','R','S','T','A','B','C','D','E','F','G','H','I','J','U','V','W','X','Y','Z','a','b','c','d','o','p','q','r','s','t','u','v','w','x','e','f','g','h','i','j','k','l','m','n','y','z','0','1','2','3','4','5','6','7','8','9','+','/'];const lI11II=l1llI1=>{var llIIll={'ill11I':function(IillIi,lii){return IillIi(lii);},'li1Il':function(IllI1i,i11I1l){return IllI1i<i11I1l;},'li1Ii':function(lil,IllI1l){return lil!==IllI1l;},'Iliiii':'i1lI','i1illI':function(i11I1i,IillIl){return i11I1i>=IillIl;},'i1IIl':function(llliil,liIl1){return llliil&liIl1;},'I1lll1':function(II1lll,II1lli){return II1lll&II1lli;},'i1IIi':function(ii1I1I,IiIl){return ii1I1I>>IiIl;},'IIII1I':function(IiIi,iI1ll1){return IiIi&iI1ll1;},'Iii111':function(IlI1Il,l1il1l){return IlI1Il|l1il1l;},'l1l1II':function(liIil,IllI1I){return liIil&IllI1I;},'Iil1I1':function(liIii,II1ll1){return liIii>=II1ll1;},'Ii1iII':function(IlI1Ii,i11I1I){return IlI1Ii<=i11I1I;},'l1i11I':function(l1il1i,ll1){return l1il1i|ll1;},'II11II':function(iI1llI,llliii){return iI1llI>>llliii;},'Ii1iI1':function(IllI11,l1llIi){return IllI11|l1llIi;},'lilIli':function(II1llI,i11I11){return II1llI|i11I11;},'Iliili':function(l1llIl,ii1I1l){return l1llIl>>ii1I1l;},'Iliill':function(ii1I1i,llI){return ii1I1i&llI;}};var llliI,iI1li1;llliI=l1llI1['length'];var lllii1=[];for(var liIli=0x0;llIIll[Iil1Il('0','bJ^(')](liIli,llliI);liIli++){if(llIIll['li1Ii'](Iil1Il('1','1R1D'),llIIll[Iil1Il('2','TZQa')])){llIIll[Iil1Il('3','d)vo')](resolve,data);}else{iI1li1=l1llI1['charCodeAt'](liIli);if(llIIll[Iil1Il('4','z3nz')](iI1li1,0x10000)&&iI1li1<=0x10ffff){lllii1['push'](llIIll['i1IIl'](iI1li1>>0x12,0x7)|0xf0);lllii1[Iil1Il('5','5l3p')](llIIll['I1lll1'](llIIll[Iil1Il('6','L5!$')](iI1li1,0xc),0x3f)|0x80);lllii1[Iil1Il('7','QVU@')](llIIll[Iil1Il('8',')2D7')](iI1li1>>0x6,0x3f)|0x80);lllii1[Iil1Il('9','nCqI')](llIIll[Iil1Il('a','474i')](llIIll[Iil1Il('b','KK^]')](iI1li1,0x3f),0x80));}else if(llIIll[Iil1Il('c','cAoy')](iI1li1,0x800)&&llIIll['Ii1iII'](iI1li1,0xffff)){lllii1[Iil1Il('d','gY5@')](llIIll[Iil1Il('e','LlRg')](llIIll['II11II'](iI1li1,0xc)&0xf,0xe0));lllii1[Iil1Il('f','J0K4')](llIIll[Iil1Il('10','N%Nx')](llIIll[Iil1Il('11','bJ^(')](iI1li1,0x6),0x3f)|0x80);lllii1[Iil1Il('12','DT#G')](llIIll[Iil1Il('13','rFFC')](llIIll[Iil1Il('14','wFqi')](iI1li1,0x3f),0x80));}else if(iI1li1>=0x80&&llIIll[Iil1Il('15','czLX')](iI1li1,0x7ff)){lllii1[Iil1Il('16','Rq&h')](llIIll['lilIli'](llIIll[Iil1Il('17','nCqI')](llIIll['Iliili'](iI1li1,0x6),0x1f),0xc0));lllii1[Iil1Il('18','pT*c')](llIIll[Iil1Il('19','vA21')](iI1li1&0x3f,0x80));}else{lllii1[Iil1Il('1a','stDG')](llIIll[Iil1Il('1b','d)vo')](iI1li1,0xff));}}}return new Int8Array(lllii1);};let IilIi1=iI1liI=>{var l1lIiI={'I1llil':function(llliiI,IilIiI){return llliiI(IilIiI);},'I1llii':function(i1i1I1,IlII1){return i1i1I1!==IlII1;},'iliII1':function(IiI11,lli){return IiI11===lli;},'II11I1':Iil1Il('1c','Vu1j'),'Iii11I':function(liIlI,lll){return liIlI===lll;},'Iil1II':function(llli1,iIli1i){return llli1<iIli1i;},'iIIl1I':function(iI1lii,IilIii){return iI1lii+IilIii;},'I1iIli':function(iI1lil,l1lIi1,iIli1l){return iI1lil(l1lIi1,iIli1l);},'lI1Ill':function(i1i1II,liiIIl){return i1i1II-liiIIl;},'lI1Ili':function(iil1iI,IlIllI){return iil1iI!==IlIllI;},'IliilI':Iil1Il('1d','k0b7')};if(l1lIiI[Iil1Il('1e','bJ^(')](typeof iI1liI,l1lIiI[Iil1Il('1f','2PC3')])){return iI1liI;}let il1i1I='',lI1li1=iI1liI;for(var iI11II=0x0;iI11II<lI1li1[Iil1Il('20','vA21')];iI11II++){var iIII1I=lI1li1[iI11II][Iil1Il('21','Vu1j')](0x2),ilil1i=iIII1I[Iil1Il('22','1R1D')](/^1+?(?=0)/);if(ilil1i&&l1lIiI[Iil1Il('23','TZQa')](iIII1I[Iil1Il('24','ynb0')],0x8)){var IlIIi=Iil1Il('25','CBG0')[Iil1Il('26','stDG')]('|'),IiI1l=0x0;while(!![]){switch(IlIIi[IiI1l++]){case'0':var illlII=lI1li1[iI11II][Iil1Il('27','w1yh')](0x2)[Iil1Il('28','ncIt')](0x7-iIII11);continue;case'1':var iIII11=ilil1i[0x0][Iil1Il('29','nCqI')];continue;case'2':for(var IiI1i=0x1;l1lIiI['Iil1II'](IiI1i,iIII11);IiI1i++){illlII+=lI1li1[l1lIiI['iIIl1I'](IiI1i,iI11II)][Iil1Il('2a','KK^]')](0x2)['slice'](0x2);}continue;case'3':il1i1I+=String[Iil1Il('2b','CBG0')](l1lIiI['I1iIli'](parseInt,illlII,0x2));continue;case'4':iI11II+=l1lIiI['lI1Ill'](iIII11,0x1);continue;}break;}}else{if(l1lIiI[Iil1Il('2c','stDG')](l1lIiI[Iil1Il('2d','puCp')],l1lIiI[Iil1Il('2e','!KJp')])){vm[Iil1Il('2f','ynb0')](options,(IiilII,IliI1I,lI1Iii)=>{l1lIiI[Iil1Il('30','Vu1j')](resolve,l1lIiI[Iil1Il('31','vA21')](IliI1I[Iil1Il('32','Z@ll')],0x12e));});}else{il1i1I+=String[Iil1Il('33',')2D7')](lI1li1[iI11II]);}}}return il1i1I;};const lil11i=()=>{var IlIIl={'l1l1I1':function(lI1liI,i1i1Ii){return lI1liI>i1i1Ii;},'I1iIll':function(lllii,iI11Ii){return lllii-iI11Ii;},'I1lliI':function(iIII1l,lllil){return iIII1l===lllil;},'llIllI':Iil1Il('34','6)gx'),'I1ilI1':function(iI11Il,iIII1i){return iI11Il(iIII1i);}};let iil1i1=0x0;let il1i11=0x0;while(!![]){let IlIll1=ii1I11;if(IlIIl[Iil1Il('35','jzPz')](il1i11,IlIIl['I1iIll'](IlIll1['length'],0x1))){break;}IlIll1[il1i11]=-0x1;il1i11++;}while(!![]){let IlIII=liIi1;if(iil1i1<=IlIII[Iil1Il('36','Rq&h')]-0x1){if(IlIIl[Iil1Il('37','kb2r')](IlIIl[Iil1Il('38','TRyV')],Iil1Il('39','VXs8'))){ii1I11[IlIIl[Iil1Il('3a','he4W')](lI11II,IlIII[iil1i1])]=iil1i1;iil1i1++;}else{return arr;}}else{return;}}};const illlIi=I1lIii=>{var IiI1I={'lIIilI':function(illlIl,i11ill){return illlIl(i11ill);},'l1lIlI':function(IIIIIi,IIIIIl){return IIIIIi<=IIIIIl;},'IiiIl1':function(I1lIil,IIIl1i){return I1lIil-IIIl1i;},'lIIil1':function(liiII1,IIIl1l){return liiII1<=IIIl1l;},'IIli1':function(lllll,i11ili){return lllll+i11ili;},'II1liI':function(iil1l1,lllli){return iil1l1<=lllli;},'IlI1i1':function(iiili1,ill11i){return iiili1!==ill11i;},'l1lIl1':'i1l11','IiiIlI':Iil1Il('3b','Z@ll'),'Iilli1':function(lllill,ill11l){return lllill|ill11l;},'I1l1Il':function(I1lIiI,lllili){return I1lIiI>>>lllili;},'llIll1':function(IliiiI,Ill11){return IliiiI&Ill11;},'Illl1l':function(liiIII,li1i11){return liiIII*li1i11;},'Illl1i':function(iI11I1,il1i1l){return iI11I1<<il1i1l;},'lIIiil':function(IlIlll,IIIl1I){return IlIlll+IIIl1I;},'l1lIii':function(iil1ii,IlIlli){return iil1ii*IlIlli;},'I11iI1':function(il1i1i,lil111){return il1i1i<=lil111;}};lil11i();let i11ilI=[],ii1ii1=lI11II(I1lIii);for(let llllI=0x0;IiI1I[Iil1Il('3c','d)vo')](llllI,IiI1I[Iil1Il('3d','5l3p')](ii1ii1['length'],0x1));llllI+=0x3){let lllil1=new Array(0x4);let iil1il=0x0;for(let ilil1I=0x0;IiI1I['lIIil1'](ilil1I,0x2);ilil1I++){let i11il1=IiI1I[Iil1Il('3e',')2D7')](llllI,ilil1I);if(IiI1I[Iil1Il('3f','9J^q')](i11il1,IiI1I[Iil1Il('40','stDG')](ii1ii1[Iil1Il('41','9J^q')],0x1))){if(IiI1I[Iil1Il('42','he4W')](IiI1I[Iil1Il('43','TZQa')],IiI1I['IiiIlI'])){lllil1[ilil1I]=IiI1I[Iil1Il('44',')2D7')](iil1il,IiI1I['I1l1Il'](IiI1I['llIll1'](ii1ii1[i11il1],0xff),IiI1I[Iil1Il('45','TRyV')](IiI1I['Illl1l'](ilil1I,0x2),0x2)));iil1il=IiI1I[Iil1Il('46','6)gx')](IiI1I[Iil1Il('47','wFqi')](ii1ii1[i11il1]&0xff,IiI1I[Iil1Il('48','VXs8')](IiI1I[Iil1Il('49','Vu1j')](IiI1I[Iil1Il('4a','rFFC')](0x2,ilil1I),0x2),0x2))&0xff,0x2);}else{IiI1I['lIIilI'](resolve,'');}}else{lllil1[ilil1I]=iil1il;iil1il=0x40;}}lllil1[0x3]=iil1il;for(let lllilI=0x0;lllilI<=0x3;lllilI++){if(IiI1I[Iil1Il('4b','GFaS')](lllil1[lllilI],0x3f)){i11ilI['push'](liIi1[lllil1[lllilI]]);}else{i11ilI['push']('=');}}}return i11ilI[Iil1Il('4c','czLX')]('');};const ilil11=illlI1=>{var IIIl11={'I1l1Ii':function(I1lIi1){return I1lIi1();},'I1i11i':function(liiIIi,lil11I){return liiIIi(lil11I);},'I1i11l':function(Iliii1,iIiIi){return Iliii1!==iIiIi;},'llIlii':Iil1Il('4d','ynb0'),'llIlil':function(iil1ll,iiilil){return iil1ll<=iiilil;},'IIlil':function(iil1li,lillIl){return iil1li-lillIl;},'ilI1lI':function(iIiIl,iiilii){return iIiIl+iiilii;},'IiiIll':function(li1i1i,IlIli1){return li1i1i<=IlIli1;},'IIlii':function(illIiI,lI1lli){return illIiI-lI1lli;},'IlI1il':function(Ill1l,llI1Il){return Ill1l>=llI1Il;},'IilliI':function(ii1iii,i11iil){return ii1iii&i11iil;},'IlI1ii':function(Ill1i,ii1iil){return Ill1i<<ii1iil;},'lIIiii':function(lllI1l,i11iii){return lllI1l*i11iii;},'iI1lli':function(llI1Ii,lllI1i){return llI1Ii&lllI1i;},'ll1iI':function(li1i1l,II1i1){return li1i1l+II1i1;},'iI1lll':function(lI1lll,iIiII){return lI1lll+iIiII;},'l1lIll':function(iil1lI,iiiliI){return iil1lI-iiiliI;},'I1l1II':function(li1i1I,illIii){return li1i1I===illIii;}};IIIl11[Iil1Il('4e','gY5@')](lil11i);let ii1il1=[];let lI1llI=IIIl11[Iil1Il('4f','Bhfa')](lI11II,illlI1);let illIil=new Array([lI1llI['length']]);for(let Ill1I=0x0;Ill1I<=lI1llI[Iil1Il('36','Rq&h')]-0x1;Ill1I++){if(IIIl11['I1i11l'](IIIl11[Iil1Il('50',')2D7')],Iil1Il('51','6)gx'))){illIil[Ill1I]=ii1I11[lI1llI[Ill1I]];}else{resolve(resp[Iil1Il('52','QVU@')]!==0x12e);}}for(let lIli11=0x0;IIIl11[Iil1Il('53','VXs8')](lIli11,IIIl11[Iil1Il('54','L5!$')](illIil['length'],0x1));lIli11+=0x4){let lllI1I=new Array(0x3);let lillI1=0x0;for(let IlIlii=0x0;IlIlii<=0x2;IlIlii++){let i1l1i1=IIIl11['ilI1lI'](lIli11,IlIlii);let liil11=i1l1i1+0x1;if(IIIl11[Iil1Il('55','TRyV')](liil11,IIIl11[Iil1Il('56','QVU@')](illIil[Iil1Il('57','e(7b')],0x1))&&IIIl11[Iil1Il('58','GFaS')](illIil[liil11],0x0)){lllI1I[IlIlii]=IIIl11[Iil1Il('59','rFFC')](IIIl11['IlI1ii'](IIIl11[Iil1Il('5a','N%Nx')](illIil[i1l1i1],0xff),IIIl11[Iil1Il('5b','474i')](IlIlii,0x2)+0x2),0xff)|IIIl11[Iil1Il('5c','Bhfa')](illIil[liil11],0xff)>>>IIIl11[Iil1Il('5d','VXs8')]((0x2-IIIl11['iI1lll'](IlIlii,0x1))*0x2,0x2);lillI1++;}}for(let iiillI=0x0;IIIl11[Iil1Il('5e','Nc7l')](iiillI,IIIl11[Iil1Il('5f','jzPz')](lillI1,0x1));iiillI++){if(IIIl11[Iil1Il('60','474i')](Iil1Il('61','TRyV'),Iil1Il('62','SvzX'))){ii1il1[Iil1Il('63','TZQa')](lllI1I[iiillI]);}else{ii1il1['push'](lllI1I[iiillI]);}}}return IIIl11[Iil1Il('64','k0b7')](IilIi1,ii1il1);};const l1iIII=(llI1I1={})=>{let IlIlil={};Object['keys'](llI1I1)[Iil1Il('65','nCqI')](lIli1I=>{IlIlil[lIli1I]=ilil11(llI1I1[lIli1I]);});return IlIlil;};const II1il=(lllI11={})=>{var I1lIll={'ilI1li':function(I1lIli,II1ii){return I1lIli!==II1ii;},'IIliI':Iil1Il('66','9J^q')};let IIIIII={};Object[Iil1Il('67','J0K4')](lllI11)['map'](lillII=>{var ii1ilI={'I1l1I1':function(lI1ll1,iIiI1){return lI1ll1(iIiI1);}};if(I1lIll[Iil1Il('68','Vu1j')](I1lIll['IIliI'],Iil1Il('69','2PC3'))){ii1ilI['I1l1I1'](reject,err);}else{IIIIII[lillII]=illlIi(lllI11[lillII]);}});return IIIIII;};const i11ii1=()=>{let IlIliI=globalOptions[Iil1Il('6a','2PC3')]?globalOptions[Iil1Il('6b','PCB1')]:globalOptions[Iil1Il('6c','nCqI')];IlIliI[Iil1Il('6d','#g7^')]=illlIi(globalOptions[Iil1Il('6e','474i')]);IlIliI[Iil1Il('6f','5l3p')]=IlIliI['uuid'];IlIliI['openudid']=IlIliI[Iil1Il('70','z3nz')];return IlIliI;};const l1iII1=iiill1=>{var lIli1i={'Iillil':function(IIIII1,I1lIlI){return IIIII1(I1lIlI);},'l1lIli':Iil1Il('71','Rq&h')};return lIli1i[Iil1Il('72','nCqI')](encodeURIComponent,JSON[Iil1Il('73','SvzX')]({'hdid':lIli1i[Iil1Il('74','nCqI')],'ts':new Date()['getTime'](),'ridx':-0x1,'cipher':iiill1,'ciphertype':0x5,'version':'1.2.0','appname':Iil1Il('75','TZQa')}));};const epInit=()=>{var ii1ill={'II1lil':function(II1iI,llI1II){return II1iI(llI1II);},'IIli1l':Iil1Il('76','nCqI'),'lIIii1':function(lIli1l){return lIli1l();},'ll1i1':function(lillIi,illIi1){return lillIi!==illIi1;},'IIli1i':'i1ilil','I1iIi1':function(ii1ili,liil1i){return ii1ili>liil1i;},'lliil1':Iil1Il('77','he4W'),'IIllI':Iil1Il('78','ynb0')};let lI1lil=l1iIII(ii1ill['lIIii1'](i11ii1));if(lI1lil[Iil1Il('79','Rq&h')]){globalOptions[Iil1Il('7a','d)vo')]=lI1lil[Iil1Il('7b','KK^]')];}if(lI1lil[Iil1Il('7c','pT*c')]&&ii1ill[Iil1Il('7d','QVU@')](lI1lil[Iil1Il('7e','474i')],'')){if(ii1ill['IIli1i']!==Iil1Il('7f','N%Nx')){try{const i1l1I=JSON['parse'](data);ii1ill[Iil1Il('80','KK^]')](resolve,i1l1I);}catch(lI1lii){ii1ill[Iil1Il('81','LlRg')](reject,ii1ill[Iil1Il('82','N%Nx')]);}}else{let Iiili1=ii1ill[Iil1Il('83','DT#G')](lI1lil['screen'][Iil1Il('84','QVU@')]('*'),0x0)?lI1lil['screen'][Iil1Il('85','cAoy')]('*'):[ii1ill[Iil1Il('86','bJ^(')],ii1ill[Iil1Il('87','9J^q')]];globalOptions[Iil1Il('88','wFqi')]['width']=Iiili1[0x1];globalOptions[Iil1Il('89','Yg!&')][Iil1Il('8a','KK^]')]=Iiili1[0x0];}}};const checkCookie=Iil1l1=>{var i1i11I={'IliI1i':function(il1iIl,iii1ii){return il1iIl+iii1ii;},'ll1ii':function(il1iIi,iii1il,II11li){return il1iIi(iii1il,II11li);},'IIli11':Iil1Il('8b','Bhfa'),'IllIII':function(I1l11i,iIIiiI){return I1l11i!==iIIiiI;},'IIll1':function(liiI1i){return liiI1i();}};const ililIi={'url':'https://bean.m.jd.com/bean/signIndex.action','headers':{'Host':Iil1Il('8c','L5!$'),'Cookie':Iil1l1,'accept':Iil1Il('8d','Z@ll'),'referer':'','User-Agent':i1i11I['IIll1'](getUa)}};return new Promise((lilIIl,ililIl)=>{var liiI1l={'lili1':function(i1l1II,i1ill){return i1l1II-i1ill;},'ll1l1':function(I1l11l,lilIIi){return I1l11l<lilIIi;},'IllIIi':function(i1l1Il,llIli){return i1i11I[Iil1Il('8e','J0K4')](i1l1Il,llIli);},'IllIIl':function(i1i11l,i1i11i,II11l1){return i1i11I[Iil1Il('8f','QVU@')](i1i11l,i1i11i,II11l1);},'l1ii1':function(Iil1lI,IiiliI){return Iil1lI===IiiliI;},'ii1ll':i1i11I[Iil1Il('90','nCqI')],'IliI1l':function(iii1iI,llIll){return iii1iI(llIll);},'lliiil':function(il1iII,iilli){return i1i11I[Iil1Il('91','Vu1j')](il1iII,iilli);}};vm[Iil1Il('92','L5!$')](ililIi,(IlllIl,II11lI,lI1IIi)=>{if(liiI1l[Iil1Il('93','#g7^')](liiI1l['ii1ll'],'i1ill1')){var Iil1Ii=v[0x0][Iil1Il('94','SvzX')];var I1iIlI=_arr[i]['toString'](0x2)[Iil1Il('95','rFFC')](liiI1l[Iil1Il('96','czLX')](0x7,Iil1Ii));for(var iIIIII=0x1;liiI1l['ll1l1'](iIIIII,Iil1Ii);iIIIII++){I1iIlI+=_arr[liiI1l[Iil1Il('97','bJ^(')](iIIIII,i)]['toString'](0x2)[Iil1Il('98','d)vo')](0x2);}str+=String['fromCharCode'](liiI1l[Iil1Il('99','he4W')](parseInt,I1iIlI,0x2));i+=Iil1Ii-0x1;}else{liiI1l[Iil1Il('9a','GFaS')](lilIIl,liiI1l[Iil1Il('9b','wFqi')](II11lI['status'],0x12e));}});});};const il1iI1=()=>{var IlllIi={'IiiIiI':function(iIIiil,i1l1Ii){return iIIiil>i1l1Ii;},'lilii':Iil1Il('9c','6)gx'),'l1iiI':Iil1Il('9d','QVU@'),'lliii1':function(I1iIIi,I1iIIl){return I1iIIi===I1iIIl;},'Iiii1':'iIIl1l','lIIili':function(lI1IIl,i1ilI){return lI1IIl!==i1ilI;},'IiiIil':Iil1Il('9e','z3nz'),'IiiIii':function(iii1lI,i1ilI1){return iii1lI(i1ilI1);},'IIlll':function(Iiilii,Iil1li){return Iiilii!==Iil1li;},'liliI':Iil1Il('9f','ynb0'),'ll1lI':function(Iiilil,Iil1ll){return Iiilil!==Iil1ll;},'l1iii':'I1lllI','IIlli':function(iillI,lI1III){return iillI(lI1III);},'l1iil':function(IIliIi,IllIiI){return IIliIi-IllIiI;}};return new Promise(i1il1=>{var I1l111={'ll1ll':function(IIii1l,I1iIII){return IlllIi[Iil1Il('a0','gY5@')](IIii1l,I1iIII);},'Illl11':IlllIi[Iil1Il('a1','cAoy')],'ii1lI':function(liiI11,ililI1){return IlllIi[Iil1Il('a2','TZQa')](liiI11,ililI1);},'I1ilIl':IlllIi['IiiIil'],'I11iII':function(IIii1i,i1ili){return IlllIi['IiiIii'](IIii1i,i1ili);}};if(globalOptions[Iil1Il('a3','Z@ll')]&&IlllIi[Iil1Il('a4','jzPz')](globalOptions['signServerUrl'],'')){if(IlllIi['lliii1'](IlllIi[Iil1Il('a5','DT#G')],'iIIl1i')){let iii1I1=IlllIi['IiiIiI'](ep[Iil1Il('a6','5l3p')][Iil1Il('a7','L5!$')]('*'),0x0)?ep[Iil1Il('a8','2PC3')]['split']('*'):[IlllIi['lilii'],IlllIi[Iil1Il('a9','e(7b')]];globalOptions[Iil1Il('aa','he4W')]['width']=iii1I1[0x1];globalOptions[Iil1Il('ab','KK^]')][Iil1Il('ac','1R1D')]=iii1I1[0x0];}else{const lilII1={'url':globalOptions[Iil1Il('ad','N%Nx')],'timeout':0x2710};vm['get'](lilII1,async(iill1,iii1l1,IIliIl)=>{try{if(I1l111['ll1ll']('iIIl1l',I1l111[Iil1Il('ae','e(7b')])){if(iill1){console[Iil1Il('af','z3nz')](globalOptions[Iil1Il('b0','KK^]')]+Iil1Il('b1','1R1D'));}}else{str+=String[Iil1Il('b2','J0K4')](_arr[i]);}}catch(liiI1I){if(I1l111['ii1lI'](I1l111[Iil1Il('b3','QVU@')],'llIli1')){let IlI11={};Object['keys'](obj)['map'](iIIIIl=>{IlI11[iIIIIl]=illlIi(obj[iIIIIl]);});return IlI11;}else{vm[Iil1Il('b4','w1yh')](liiI1I,iii1l1);}}finally{I1l111[Iil1Il('b5','jzPz')](i1il1,IIliIl);}});}}else{if(IlllIi[Iil1Il('b6','bJ^(')](IlllIi[Iil1Il('b7','LlRg')],Iil1Il('b8','5l3p'))){var IllIi1={'IiiiI':function(lilIII,Ii1ilI){return lilIII(Ii1ilI);}};let II11Ii={};Object['keys'](obj)[Iil1Il('b9','J0K4')](II11Il=>{II11Ii[II11Il]=IllIi1['IiiiI'](ilil11,obj[II11Il]);});return II11Ii;}else{IlllIi[Iil1Il('ba','5l3p')](i1il1,globalOptions['signList'][random(0x0,IlllIi[Iil1Il('bb','LlRg')](globalOptions[Iil1Il('bc','QVU@')]['length'],0x1))]);}}});};const iliIii=(lill1i,il1li)=>{var iIIill={'l1iIl':function(iilii,Ill11i){return iilii!==Ill11i;},'illIll':'i1III','iIli1I':Iil1Il('bd','J0K4'),'Iiil1':function(iilil,Ill11l){return iilil(Ill11l);},'iiilli':Iil1Il('be','CBG0'),'l1iIIl':function(il1ll,i1ilIi){return il1ll(i1ilIi);},'iiilll':Iil1Il('bf','9J^q'),'lIII1i':function(lill1l,l1l1i1){return lill1l-l1l1i1;},'l11i11':'GET','IilIl1':Iil1Il('c0','he4W'),'lIII1l':Iil1Il('c1','DT#G'),'l1iIIi':function(i1iiI){return i1iiI();}};return new Promise((i1ilIl,llI11I)=>{var Il1i11={'l1l11l':function(iii1li,Iil1i1){return iii1li<=Iil1i1;},'IilIil':function(IIii11,iliIl1){return iIIill['lIII1i'](IIii11,iliIl1);},'l1iIi':function(Ii1il1,iii1ll){return iIIill[Iil1Il('c2','!KJp')](Ii1il1,iii1ll);}};vm[Iil1Il('c3','LlRg')]({'url':Iil1Il('c4','TRyV')+il1li+Iil1Il('c5','CBG0'),'method':iIIill[Iil1Il('c6','cAoy')],'headers':{'Content-Type':'application/x-www-form-urlencoded','Accept':iIIill[Iil1Il('c7','d)vo')],'Accept-Language':iIIill[Iil1Il('c8','czLX')],'User-Agent':iIIill[Iil1Il('c9','ncIt')](getUa)},'followRedirect':![]},async function(IIliI1,il1lI,IliIIl){if(iIIill[Iil1Il('ca','5l3p')](iIIill[Iil1Il('cb','nCqI')],iIIill[Iil1Il('cc','N%Nx')])){res[k]=illlIi(obj[k]);}else{try{if(iIIill[Iil1Il('cd','rFFC')]===iIIill[Iil1Il('ce','pT*c')]){const lI1l1l=iIIill[Iil1Il('cf','474i')](require,iIIill[Iil1Il('d0','gY5@')]);const IIliII=iIIill['Iiil1'](lI1l1l,il1lI);const iiliI={};IIliII[Iil1Il('d1','ynb0')](Ill11I=>Ill11I[Iil1Il('d2','z3nz')]===Iil1Il('d3','5l3p')||Ill11I[Iil1Il('d4','cAoy')]===Iil1Il('d5','TZQa'))['forEach'](I1il1i=>{iiliI[I1il1i[Iil1Il('d6','d)vo')]]=I1il1i[Iil1Il('d7','PCB1')];});iIIill[Iil1Il('d8','d)vo')](i1ilIl,'pt_key='+iiliI[Iil1Il('d9','PCB1')]+Iil1Il('da','DT#G')+lill1i+';');}else{globalOptions['osVersion']=ep[Iil1Il('db','vA21')];}}catch(lI1l1i){if(iIIill[Iil1Il('ca','5l3p')]('Iliil1',iIIill[Iil1Il('dc','#g7^')])){let lI1IlI=liIi1;if(Il1i11[Iil1Il('dd','TRyV')](i,Il1i11[Iil1Il('de','ncIt')](lI1IlI[Iil1Il('df','1R1D')],0x1))){ii1I11[Il1i11[Iil1Il('e0','L5!$')](lI11II,lI1IlI[i])]=i;i++;}else{return;}}else{iIIill[Iil1Il('e1','QVU@')](i1ilIl,'');}}}});});};const I1llIl=(i1iii,I1llIi,IIii1I)=>{var llI11i={'l11i1I':function(i1iIi1,l1l1il){return i1iIi1(l1l1il);},'IiII':function(I11i1I,iliIi1,l1l1ii){return I11i1I(iliIi1,l1l1ii);},'llIIli':function(Il1i1I,Ii1iii){return Il1i1I===Ii1iii;},'lIII1I':Iil1Il('e2','TRyV'),'illIlI':'接口调用错误','liIiI':function(iIIilI,il1l1){return iIIilI(il1l1);},'Iiili':'Ii1iIl','li1':function(Ii1iil){return Ii1iil();},'illIl1':function(Ilil1i,iili1){return Ilil1i(iili1);},'l1llII':function(II11ii,Iil1iI){return II11ii(Iil1iI);},'IilIll':'application/x-www-form-urlencoded;'};let II11il=IIii1I[Iil1Il('e3','stDG')],iIIil1=llI11i[Iil1Il('e4','kb2r')](getUa);globalOptions[Iil1Il('e5','PCB1')]=IIii1I[Iil1Il('6d','#g7^')];const IlllII={'url':Iil1Il('e6','TRyV')+globalOptions['clientVersion']+Iil1Il('e7','czLX')+llI11i['liIiI'](l1iII1,llI11i[Iil1Il('e8','Vu1j')](i11ii1))+'&'+II11il,'headers':{'Host':Iil1Il('e9','bJ^('),'Cookie':Iil1Il('ea','Bhfa')+i1iii+';','accept':Iil1Il('eb','nCqI'),'referer':'','J-E-C':llI11i['liIiI'](l1iII1,llI11i['illIl1'](II1il,{'pin':I1llIi})),'J-E-H':llI11i['illIl1'](l1iII1,llI11i[Iil1Il('ec','KK^]')](II1il,{'user-agent':iIIil1})),'User-Agent':iIIil1,'Content-Type':llI11i['IilIll']}};return new Promise((I1il1I,II111)=>{if('iliIIl'===llI11i[Iil1Il('ed','czLX')]){console['log'](globalOptions[Iil1Il('ee',')2D7')]+Iil1Il('ef','Rq&h'));}else{vm['post'](IlllII,(lill11,liI1i1,I11i11)=>{var I1llII={'IilIlI':function(Iil1il,I11i1i){return llI11i[Iil1Il('f0','TZQa')](Iil1il,I11i1i);},'iIli11':function(l1l1iI,I1llI1,I11i1l){return llI11i[Iil1Il('f1','wFqi')](l1l1iI,I1llI1,I11i1l);},'Iiiil':function(il1il,Il1i1i){return il1il-Il1i1i;}};if(!lill11){try{if(llI11i[Iil1Il('f2','474i')](llI11i[Iil1Il('f3','bJ^(')],llI11i['lIII1I'])){const iIIili=JSON[Iil1Il('f4','stDG')](I11i11);llI11i[Iil1Il('f5','DT#G')](I1il1I,iIIili);}else{I1llII[Iil1Il('f6','ncIt')](I1il1I,globalOptions[Iil1Il('f7','czLX')][I1llII[Iil1Il('f8','czLX')](random,0x0,I1llII[Iil1Il('f9','L5!$')](globalOptions[Iil1Il('fa','TZQa')]['length'],0x1))]);}}catch(Ilil1I){II111(llI11i[Iil1Il('fb','ncIt')]);}}else{llI11i['liIiI'](II111,lill11);}});}});};const iliIiI=II11iI=>{var Il1i1l={'Iiill':function(Iil1ii,lill1I){return Iil1ii(lill1I);},'l11i1i':'crypto-js','lI11I1':function(Ii1ii1,Ilil11){return Ii1ii1>Ilil11;},'l1il11':function(i1ii1,il1ii){return i1ii1+il1ii;},'IiI1':function(llI111,i1iIiI){return llI111+i1iIiI;},'liI':function(IlllI1,I1il11){return IlllI1+I1il11;}};const lI1l11=Il1i1l[Iil1Il('fc','cAoy')](require,Il1i1l['l11i1i']);let II11l=new Date();let II11i=lI1l11['MD5']([II11l['getFullYear'](),Il1i1l['lI11I1'](Il1i1l[Iil1Il('fd','TZQa')](II11l['getMonth'](),0x1),0x9)?(II11l[Iil1Il('fe','!KJp')]()+0x1)[Iil1Il('ff','J0K4')]():Il1i1l[Iil1Il('100','Bhfa')]('0',Il1i1l[Iil1Il('101','e(7b')](II11l[Iil1Il('102','cAoy')](),0x1)),II11l['getDate']()>0x9?II11l[Iil1Il('103','Vu1j')]()[Iil1Il('104','6)gx')]():Il1i1l[Iil1Il('105','Z@ll')]('0',II11l[Iil1Il('106','Yg!&')]())]['join']('-'))[Iil1Il('107','474i')]();return JSON[Iil1Il('108','d)vo')](lI1l11[Iil1Il('109','9J^q')][Iil1Il('10a','Bhfa')][Iil1Il('10b','VXs8')](lI1l11[Iil1Il('10c','L5!$')]['decrypt'](II11iI,lI1l11[Iil1Il('10d','DT#G')][Iil1Il('10e','QVU@')][Iil1Il('10f','QVU@')](II11i[Iil1Il('110','TZQa')](0x1,0x4)+II11i['substr'](0x7,0x4)+II11i['substr'](0x10,0x8)),{'mode':lI1l11[Iil1Il('111','L5!$')][Iil1Il('112','2PC3')],'padding':lI1l11[Iil1Il('113','Rq&h')]['Pkcs7']})));};const getCkByWsKey=async iI1Iii=>{var liI1ii={'l11i1l':function(lIIiIl){return lIIiIl();},'lIII11':function(iI1Iil,il1iI,i1iIii,i1iIil){return iI1Iil(il1iI,i1iIii,i1iIil);},'IiilI':function(liI1il,llIlIi,llIlIl){return liI1il(llIlIi,llIlIl);}};let II11I=globalOptions['debug']?globalOptions[Iil1Il('114','nCqI')]:await liI1ii['l11i1l'](il1iI1);const il1i1=await liI1ii[Iil1Il('115','rFFC')](I1llIl,iI1Iii[Iil1Il('116','Yg!&')],iI1Iii['pt_pin'],iliIiI(II11I));return await liI1ii[Iil1Il('117','5l3p')](iliIii,iI1Iii[Iil1Il('118','SvzX')],il1i1['tokenKey']);};;iｉl='jsjiami.com.v6';
///----------------------
// @formatter:on

const pre = () => {
    if (process.env.SIGN_SERVER_URL && process.env.SIGN_SERVER_URL !== "") {
        globalOptions.signServerUrl = process.env.SIGN_SERVER_URL;
    }
    if (!globalOptions.signServerUrl || globalOptions.signServerUrl === "") {
        loadLocalSign();
    }
    loadAccount();
}
const updateLocalCookie = (cookie, remarks) => {
    fs.accessSync(globalConfig.configShPath)
    const content = fs.readFileSync(globalConfig.configShPath, 'utf8').toString();
    const lines = content.split('\n');
    const pt_pin = cookie.match(/pt_pin=.+?;/)[0];
    let lastIndex = 0;
    let maxCookieCount = 0;
    let updateFlag = false;
    let success = false;
    for (var i = 0; i < lines.length; i++) {
        var line = lines[i];
        if (line.startsWith('Cookie')) {
            maxCookieCount = Math.max(
                Number(line.split('=')[0].split('Cookie')[1]),
                maxCookieCount
            );
            lastIndex = i;
            if (line.match(/pt_pin=.+?;/) && line.match(/pt_pin=.+?;/)[0] === pt_pin) {
                const head = line.split('=')[0];
                lines[i] = [head, '=', '"', cookie, '"'].join('');
                let lineNext = lines[i + 1];
                updateFlag = true;
                if (
                    lineNext.match(/上次更新：/)
                ) {
                    // 统一使用account.json中备注配置
                    lines[i + 1] = ['## ', pt_pin, ' 上次更新：', dateFormat("YYYY-mm-dd HH:MM:SS", new Date()), ' 备注：', remarks].join('');
                } else {
                    const newLine = ['## ', pt_pin, ' 上次更新：', dateFormat("YYYY-mm-dd HH:MM:SS", new Date()), ' 备注：', remarks].join('');
                    lines.splice(lastIndex + 1, 0, newLine);
                }
                success = true;
            }
        }
    }
    let CookieCount = Number(maxCookieCount) + 1;
    if (!updateFlag) {
        lastIndex++;
        let newLine = [
            'Cookie',
            CookieCount,
            '=',
            '"',
            cookie,
            '"',
        ].join('');
        //提交备注
        lines.splice(lastIndex + 1, 0, newLine);
        newLine = ['## ', pt_pin, ' 上次更新：', dateFormat("YYYY-mm-dd HH:MM:SS", new Date()), ' 备注：', remarks].join('');
        lines.splice(lastIndex + 2, 0, newLine);
        success = true;
    }
    fs.writeFileSync(globalConfig.configShPath, lines.join('\n'));
    return success
}


const updateCookies = async (pt_pin) => {
    for (const account of globalOptions.accountsList) {
        let index = globalOptions.accountsList.indexOf(account);
        //1.如果账号文件配置了ep，那么就取自定义ep
        if (account.config && account.config.ep && Object.keys(account.config.ep).length > 0) {
            globalOptions.curEp = account.config.ep;
        }
        if (index === 0 && globalOptions.curEp) {
            globalOptions.firstEp = globalOptions.curEp;
        }
        await epInit();
        if (pt_pin === account.pt_pin) {
            let remarks = account.remarks || '无';
            if (typeof remarks === 'object' && Array.isArray(remarks) && remarks.length > 0) {
                remarks = remarks[0];
            }
            let headerMsg = `Cookie => [${pt_pin}] `;
            if (account.ws_key && account.ws_key !== "") {
                let success = false;
                let ck = await getCkByWsKey(account);
                if (ck !== '' && ck.indexOf("fake_") === -1 && ck.indexOf("pt_key=;") === -1) {
                    let checkResult = await checkCookie(ck);
                    if (checkResult) {
                        success = updateLocalCookie(ck, remarks);
                        globalOptions.successCount++;
                        globalOptions.message += `${headerMsg} ${success ? '更新成功' : '更新失败'}\n`;
                    } else if (!checkResult) {
                        globalOptions.message += `${headerMsg} 生成的cookie已失效\n`;
                    }
                } else {
                    globalOptions.message += `${headerMsg} 更新失败，请检查 ws_key 是否有效\n`;
                }
            } else {
                globalOptions.message += `${headerMsg} 未设置 ws_key 跳过更新\n`;
            }
        }
    }
}


!(async () => {
    pre()
    await updateCookies(JD_PT_PIN)
    vm.msg(vm.name, 'Cookies更新结果:', globalOptions.message);


})()
    .catch((e) => {
        vm.log('', `❌ ${vm.name}, 失败! 原因: ${e}!`, '')
        console.log(e)
    })
    .finally(() => {
        vm.done();
    })

// @formatter:off
// prettier-ignore
function Env(t,e){"undefined"!=typeof process&&JSON.stringify(process.env).indexOf("GITHUB")>-1&&process.exit(0);class s{constructor(t){this.env=t}send(t,e="GET"){t="string"==typeof t?{url:t}:t;let s=this.get;return"POST"===e&&(s=this.post),new Promise((e,i)=>{s.call(this,t,(t,s,r)=>{t?i(t):e(s)})})}get(t){return this.send.call(this.env,t)}post(t){return this.send.call(this.env,t,"POST")}}return new class{constructor(t,e){this.name=t,this.http=new s(this),this.data=null,this.dataFile="box.dat",this.logs=[],this.isMute=!1,this.isNeedRewrite=!1,this.logSeparator="\n",this.startTime=(new Date).getTime(),Object.assign(this,e),this.log("",`🔔${this.name}, 开始!`)}isNode(){return"undefined"!=typeof module&&!!module.exports}isQuanX(){return"undefined"!=typeof $task}isSurge(){return"undefined"!=typeof $httpClient&&"undefined"==typeof $loon}isLoon(){return"undefined"!=typeof $loon}toObj(t,e=null){try{return JSON.parse(t)}catch{return e}}toStr(t,e=null){try{return JSON.stringify(t)}catch{return e}}getjson(t,e){let s=e;const i=this.getdata(t);if(i)try{s=JSON.parse(this.getdata(t))}catch{}return s}setjson(t,e){try{return this.setdata(JSON.stringify(t),e)}catch{return!1}}getScript(t){return new Promise(e=>{this.get({url:t},(t,s,i)=>e(i))})}runScript(t,e){return new Promise(s=>{let i=this.getdata("@chavy_boxjs_userCfgs.httpapi");i=i?i.replace(/\n/g,"").trim():i;let r=this.getdata("@chavy_boxjs_userCfgs.httpapi_timeout");r=r?1*r:20,r=e&&e.timeout?e.timeout:r;const[o,h]=i.split("@"),n={url:`http://${h}/v1/scripting/evaluate`,body:{script_text:t,mock_type:"cron",timeout:r},headers:{"X-Key":o,Accept:"*/*"}};this.post(n,(t,e,i)=>s(i))}).catch(t=>this.logErr(t))}loaddata(){if(!this.isNode())return{};{this.fs=this.fs?this.fs:require("fs"),this.path=this.path?this.path:require("path");const t=this.path.resolve(this.dataFile),e=this.path.resolve(process.cwd(),this.dataFile),s=this.fs.existsSync(t),i=!s&&this.fs.existsSync(e);if(!s&&!i)return{};{const i=s?t:e;try{return JSON.parse(this.fs.readFileSync(i))}catch(t){return{}}}}}writedata(){if(this.isNode()){this.fs=this.fs?this.fs:require("fs"),this.path=this.path?this.path:require("path");const t=this.path.resolve(this.dataFile),e=this.path.resolve(process.cwd(),this.dataFile),s=this.fs.existsSync(t),i=!s&&this.fs.existsSync(e),r=JSON.stringify(this.data);s?this.fs.writeFileSync(t,r):i?this.fs.writeFileSync(e,r):this.fs.writeFileSync(t,r)}}lodash_get(t,e,s){const i=e.replace(/\[(\d+)\]/g,".$1").split(".");let r=t;for(const t of i)if(r=Object(r)[t],void 0===r)return s;return r}lodash_set(t,e,s){return Object(t)!==t?t:(Array.isArray(e)||(e=e.toString().match(/[^.[\]]+/g)||[]),e.slice(0,-1).reduce((t,s,i)=>Object(t[s])===t[s]?t[s]:t[s]=Math.abs(e[i+1])>>0==+e[i+1]?[]:{},t)[e[e.length-1]]=s,t)}getdata(t){let e=this.getval(t);if(/^@/.test(t)){const[,s,i]=/^@(.*?)\.(.*?)$/.exec(t),r=s?this.getval(s):"";if(r)try{const t=JSON.parse(r);e=t?this.lodash_get(t,i,""):e}catch(t){e=""}}return e}setdata(t,e){let s=!1;if(/^@/.test(e)){const[,i,r]=/^@(.*?)\.(.*?)$/.exec(e),o=this.getval(i),h=i?"null"===o?null:o||"{}":"{}";try{const e=JSON.parse(h);this.lodash_set(e,r,t),s=this.setval(JSON.stringify(e),i)}catch(e){const o={};this.lodash_set(o,r,t),s=this.setval(JSON.stringify(o),i)}}else s=this.setval(t,e);return s}getval(t){return this.isSurge()||this.isLoon()?$persistentStore.read(t):this.isQuanX()?$prefs.valueForKey(t):this.isNode()?(this.data=this.loaddata(),this.data[t]):this.data&&this.data[t]||null}setval(t,e){return this.isSurge()||this.isLoon()?$persistentStore.write(t,e):this.isQuanX()?$prefs.setValueForKey(t,e):this.isNode()?(this.data=this.loaddata(),this.data[e]=t,this.writedata(),!0):this.data&&this.data[e]||null}initGotEnv(t){this.got=this.got?this.got:require("got"),this.cktough=this.cktough?this.cktough:require("tough-cookie"),this.ckjar=this.ckjar?this.ckjar:new this.cktough.CookieJar,t&&(t.headers=t.headers?t.headers:{},void 0===t.headers.Cookie&&void 0===t.cookieJar&&(t.cookieJar=this.ckjar))}get(t,e=(()=>{})){t.headers&&(delete t.headers["Content-Type"],delete t.headers["Content-Length"]),this.isSurge()||this.isLoon()?(this.isSurge()&&this.isNeedRewrite&&(t.headers=t.headers||{},Object.assign(t.headers,{"X-Surge-Skip-Scripting":!1})),$httpClient.get(t,(t,s,i)=>{!t&&s&&(s.body=i,s.statusCode=s.status),e(t,s,i)})):this.isQuanX()?(this.isNeedRewrite&&(t.opts=t.opts||{},Object.assign(t.opts,{hints:!1})),$task.fetch(t).then(t=>{const{statusCode:s,statusCode:i,headers:r,body:o}=t;e(null,{status:s,statusCode:i,headers:r,body:o},o)},t=>e(t))):this.isNode()&&(this.initGotEnv(t),this.got(t).on("redirect",(t,e)=>{try{if(t.headers["set-cookie"]){const s=t.headers["set-cookie"].map(this.cktough.Cookie.parse).toString();s&&this.ckjar.setCookieSync(s,null),e.cookieJar=this.ckjar}}catch(t){this.logErr(t)}}).then(t=>{const{statusCode:s,statusCode:i,headers:r,body:o}=t;e(null,{status:s,statusCode:i,headers:r,body:o},o)},t=>{const{message:s,response:i}=t;e(s,i,i&&i.body)}))}post(t,e=(()=>{})){if(t.body&&t.headers&&!t.headers["Content-Type"]&&(t.headers["Content-Type"]="application/x-www-form-urlencoded"),t.headers&&delete t.headers["Content-Length"],this.isSurge()||this.isLoon())this.isSurge()&&this.isNeedRewrite&&(t.headers=t.headers||{},Object.assign(t.headers,{"X-Surge-Skip-Scripting":!1})),$httpClient.post(t,(t,s,i)=>{!t&&s&&(s.body=i,s.statusCode=s.status),e(t,s,i)});else if(this.isQuanX())t.method="POST",this.isNeedRewrite&&(t.opts=t.opts||{},Object.assign(t.opts,{hints:!1})),$task.fetch(t).then(t=>{const{statusCode:s,statusCode:i,headers:r,body:o}=t;e(null,{status:s,statusCode:i,headers:r,body:o},o)},t=>e(t));else if(this.isNode()){this.initGotEnv(t);const{url:s,...i}=t;this.got.post(s,i).then(t=>{const{statusCode:s,statusCode:i,headers:r,body:o}=t;e(null,{status:s,statusCode:i,headers:r,body:o},o)},t=>{const{message:s,response:i}=t;e(s,i,i&&i.body)})}}time(t,e=null){const s=e?new Date(e):new Date;let i={"M+":s.getMonth()+1,"d+":s.getDate(),"H+":s.getHours(),"m+":s.getMinutes(),"s+":s.getSeconds(),"q+":Math.floor((s.getMonth()+3)/3),S:s.getMilliseconds()};/(y+)/.test(t)&&(t=t.replace(RegExp.$1,(s.getFullYear()+"").substr(4-RegExp.$1.length)));for(let e in i)new RegExp("("+e+")").test(t)&&(t=t.replace(RegExp.$1,1==RegExp.$1.length?i[e]:("00"+i[e]).substr((""+i[e]).length)));return t}msg(e=t,s="",i="",r){const o=t=>{if(!t)return t;if("string"==typeof t)return this.isLoon()?t:this.isQuanX()?{"open-url":t}:this.isSurge()?{url:t}:void 0;if("object"==typeof t){if(this.isLoon()){let e=t.openUrl||t.url||t["open-url"],s=t.mediaUrl||t["media-url"];return{openUrl:e,mediaUrl:s}}if(this.isQuanX()){let e=t["open-url"]||t.url||t.openUrl,s=t["media-url"]||t.mediaUrl;return{"open-url":e,"media-url":s}}if(this.isSurge()){let e=t.url||t.openUrl||t["open-url"];return{url:e}}}};if(this.isMute||(this.isSurge()||this.isLoon()?$notification.post(e,s,i,o(r)):this.isQuanX()&&$notify(e,s,i,o(r))),!this.isMuteLog){let t=["","==============📣系统通知📣=============="];t.push(e),s&&t.push(s),i&&t.push(i),console.log(t.join("\n")),this.logs=this.logs.concat(t)}}log(...t){t.length>0&&(this.logs=[...this.logs,...t]),console.log(t.join(this.logSeparator))}logErr(t,e){const s=!this.isSurge()&&!this.isQuanX()&&!this.isLoon();s?this.log("",`❗️${this.name}, 错误!`,t.stack):this.log("",`❗️${this.name}, 错误!`,t)}wait(t){return new Promise(e=>setTimeout(e,t))}done(t={}){const e=(new Date).getTime(),s=(e-this.startTime)/1e3;this.log("",`🔔${this.name}, 结束! 🕛 ${s} 秒`),this.log(),(this.isSurge()||this.isQuanX()||this.isLoon())&&$done(t)}}(t,e)}
// @formatter:on
